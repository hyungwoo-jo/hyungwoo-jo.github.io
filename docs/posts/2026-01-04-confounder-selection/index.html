<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Hyungwoo Jo">
<meta name="dcterms.date" content="2026-01-04">
<meta name="description" content="교란변수는 어떻게 선택해야 하나: data-driven의 함정과 collider">
<title>Causal Inference (3): Confounder Selection &amp; Collider Bias – Analytics Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-de84f8d6bb715db06a919283c2d1e787.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-6cd848dc9278ff8c2bd512f804fe0bcd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<script src="../../site_libs/quarto-diagram/mermaid.min.js"></script><script src="../../site_libs/quarto-diagram/mermaid-init.js"></script><link href="../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="../../styles.css">
</head>
<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Analytics Notes</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
<ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item compact">
    <a class="nav-link" href="https://github.com/sl-eeper"> <i class="bi bi-github" role="img" aria-label="GitHub Profile">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full"><div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Causal Inference (3): Confounder Selection &amp; Collider Bias</h1>
                  <div>
        <div class="description">
          교란변수는 어떻게 선택해야 하나: data-driven의 함정과 collider
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">statistics</div>
                <div class="quarto-category">causal-inference</div>
                <div class="quarto-category">R</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://github.com/hyungwoo-jo">Hyungwoo Jo</a> </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">January 4, 2026</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li><a href="#confounder%EB%A5%BC-%EA%B3%A0%EB%A5%B4%EB%8A%94-%EB%AC%B8%EC%A0%9C%EB%8A%94-%ED%86%B5%EA%B3%84%EA%B0%80-%EC%95%84%EB%8B%88%EB%9D%BC-%EC%9D%B8%EA%B3%BC%EB%8B%A4" id="toc-confounder를-고르는-문제는-통계가-아니라-인과다" class="nav-link active" data-scroll-target="#confounder%EB%A5%BC-%EA%B3%A0%EB%A5%B4%EB%8A%94-%EB%AC%B8%EC%A0%9C%EB%8A%94-%ED%86%B5%EA%B3%84%EA%B0%80-%EC%95%84%EB%8B%88%EB%9D%BC-%EC%9D%B8%EA%B3%BC%EB%8B%A4">1. Confounder를 고르는 문제는 “통계”가 아니라 “인과”다</a></li>
  <li><a href="#%EC%9D%98%ED%95%99-%EC%97%B0%EA%B5%AC%EC%97%90%EC%84%9C-%ED%9D%94%ED%95%9C-data-driven-%EC%84%A0%ED%83%9D-p-value-forwardbackward-stepwise" id="toc-의학-연구에서-흔한-data-driven-선택-p-value-forwardbackward-stepwise" class="nav-link" data-scroll-target="#%EC%9D%98%ED%95%99-%EC%97%B0%EA%B5%AC%EC%97%90%EC%84%9C-%ED%9D%94%ED%95%9C-data-driven-%EC%84%A0%ED%83%9D-p-value-forwardbackward-stepwise">2. 의학 연구에서 흔한 data-driven 선택: p-value, forward/backward stepwise</a></li>
  <li><a href="#collider%EA%B0%80-%EC%99%9C-%EC%9C%84%ED%97%98%ED%95%9C%EA%B0%80-hba1c-%EC%98%88%EC%8B%9C%EB%A1%9C-%EC%97%B0%EA%B2%B0%ED%95%98%EA%B8%B0" id="toc-collider가-왜-위험한가-hba1c-예시로-연결하기" class="nav-link" data-scroll-target="#collider%EA%B0%80-%EC%99%9C-%EC%9C%84%ED%97%98%ED%95%9C%EA%B0%80-hba1c-%EC%98%88%EC%8B%9C%EB%A1%9C-%EC%97%B0%EA%B2%B0%ED%95%98%EA%B8%B0">3. Collider가 왜 위험한가: HbA1c 예시로 연결하기</a></li>
  <li><a href="#r-%EC%8B%9C%EB%AE%AC%EB%A0%88%EC%9D%B4%EC%85%98-%EC%A0%84%ED%86%B5%EC%A0%81-%EC%84%A0%ED%83%9D%EC%9D%B4-collider%EB%A5%BC-%EB%81%BC%EC%9B%8C-%EB%84%A3%EB%8A%94-%EC%88%9C%EA%B0%84" id="toc-r-시뮬레이션-전통적-선택이-collider를-끼워-넣는-순간" class="nav-link" data-scroll-target="#r-%EC%8B%9C%EB%AE%AC%EB%A0%88%EC%9D%B4%EC%85%98-%EC%A0%84%ED%86%B5%EC%A0%81-%EC%84%A0%ED%83%9D%EC%9D%B4-collider%EB%A5%BC-%EB%81%BC%EC%9B%8C-%EB%84%A3%EB%8A%94-%EC%88%9C%EA%B0%84">4. R 시뮬레이션: 전통적 선택이 collider를 끼워 넣는 순간</a></li>
  <li><a href="#%EC%A0%84%ED%86%B5%EC%A0%81-%EC%A0%88%EC%B0%A8%EB%A5%BC-%EA%B7%B8%EB%8C%80%EB%A1%9C-%EB%94%B0%EB%9D%BC%ED%95%98%EB%A9%B4%EC%8A%A4%ED%81%AC%EB%A6%AC%EB%8B%9Dstepwise-%EB%AC%B4%EC%8A%A8-%EC%9D%BC%EC%9D%B4-%EC%83%9D%EA%B8%B8%EA%B9%8C" id="toc-전통적-절차를-그대로-따라하면스크리닝stepwise-무슨-일이-생길까" class="nav-link" data-scroll-target="#%EC%A0%84%ED%86%B5%EC%A0%81-%EC%A0%88%EC%B0%A8%EB%A5%BC-%EA%B7%B8%EB%8C%80%EB%A1%9C-%EB%94%B0%EB%9D%BC%ED%95%98%EB%A9%B4%EC%8A%A4%ED%81%AC%EB%A6%AC%EB%8B%9Dstepwise-%EB%AC%B4%EC%8A%A8-%EC%9D%BC%EC%9D%B4-%EC%83%9D%EA%B8%B8%EA%B9%8C">5. 전통적 절차를 그대로 따라하면(스크리닝/stepwise) 무슨 일이 생길까?</a></li>
  <li><a href="#%EA%B2%B0%EB%A1%A0-%EA%B0%80%EC%9E%A5-%EC%9D%B4%EC%83%81%EC%A0%81%EC%9D%B8-%EC%A0%91%EA%B7%BC%EC%9D%80-knowledge-driven%EC%9D%B4%EB%8B%A4" id="toc-결론-가장-이상적인-접근은-knowledge-driven이다" class="nav-link" data-scroll-target="#%EA%B2%B0%EB%A1%A0-%EA%B0%80%EC%9E%A5-%EC%9D%B4%EC%83%81%EC%A0%81%EC%9D%B8-%EC%A0%91%EA%B7%BC%EC%9D%80-knowledge-driven%EC%9D%B4%EB%8B%A4">6. 결론: 가장 이상적인 접근은 knowledge-driven이다</a></li>
  </ul></nav>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content"><p>앞선 글에서는 성향점수(PSM, IPTW)로 “치료군과 대조군을 비교 가능하게 만드는 방법”을 다뤘다. 그런데 성향점수든 회귀 보정이든, 결국 한 가지 질문으로 수렴한다. <strong>무엇을 보정해야 하는가?</strong></p>
<p>많은 의학 논문에서 공변량은 관행적으로 선택된다. 예컨대 공변량 후보를 여러 개 두고 결과와의 연관성을 p-value로 훑은 뒤(p&lt;0.1 같은 기준), 남은 변수들로 다변량 모델을 구성하거나, forward/backward stepwise로 “최종 모델”을 만든다. 이런 방식이 등장하는 이유는 현실적이다. 표본이나 사건 수가 제한적이면 과적합이 걱정되고, 공변량 후보는 끝없이 늘어나며, “유의한 것만 남기는 모델”이 깔끔해 보이기 때문이다.</p>
<p>하지만 인과추론에서 변수 선택은 “예측이 잘 되는 모델”을 고르는 문제가 아니다. 우리가 추정하려는 것은 <span class="math inline">\(T \rightarrow Y\)</span> 인과효과이고, 조정의 목적은 <strong>backdoor path를 닫아 편향을 줄이는 것</strong>이다. 특히 <strong>collider(충돌 변수)</strong>를 조정하거나, collider로 표본을 제한하면 편향이 “줄어드는” 것이 아니라 “새로 생길 수” 있다. 예측에는 도움이 되는 변수가 인과추정에는 위험한 변수가 되는 순간이다.</p>
<p>이 글에서는 먼저 의학 연구에서 흔한 data-driven confounder 선택 관행을 정리하고, collider가 왜 위험한지 설명한 뒤, R 시뮬레이션으로 “전통적 방법이 collider를 포함해 결과를 왜곡하는” 상황을 보여준다. 마지막으로 현실적으로 가장 이상적인 접근(knowledge-driven)을 정리해보겠다.</p>
<hr>
<section id="confounder를-고르는-문제는-통계가-아니라-인과다" class="level2"><h2 class="anchored" data-anchor-id="confounder를-고르는-문제는-통계가-아니라-인과다">1. Confounder를 고르는 문제는 “통계”가 아니라 “인과”다</h2>
<p>교란변수는 간단히 말해 <strong>치료/노출(</strong><span class="math inline">\(T\)</span>)과 결과(<span class="math inline">\(Y\)</span>) 모두에 영향을 주는 변수다. 예를 들어 “흡연이 HbA1c를 올리는가?”를 보고 싶다면, 나이·성별·운동·식습관·음주 같은 변수는 흡연과 HbA1c 모두와 연관될 수 있다. 이때 단순 비교는 “흡연 효과”가 아니라 “기본 특성 차이”를 섞어서 보게 된다.</p>
<p>그래서 우리는 <span class="math inline">\(T\)</span>와 <span class="math inline">\(Y\)</span> 사이의 비교가 “교환가능성(exchangeability)”에 가까워지도록 공변량을 조정한다. 그런데 여기서 핵심은, 공변량 선택이 “결과와 상관이 있는 변수”를 찾는 문제가 아니라, <span class="math inline">\(T \rightarrow Y\)</span> 인과효과를 추정할 때 열려 있는 backdoor path를 닫는 문제라는 점이다.</p>
<hr></section><section id="의학-연구에서-흔한-data-driven-선택-p-value-forwardbackward-stepwise" class="level2"><h2 class="anchored" data-anchor-id="의학-연구에서-흔한-data-driven-선택-p-value-forwardbackward-stepwise">2. 의학 연구에서 흔한 data-driven 선택: p-value, forward/backward stepwise</h2>
<p>현장에서 자주 보는 방식은 크게 두 가지다.</p>
<p>첫째는 univariate screening이다. 공변량 후보를 하나씩 결과와 연결해 보고(p-value), 일정 기준을 넘는 변수만 “후보”로 올린 뒤 다변량 모델을 만든다. 둘째는 stepwise selection이다. 후보 변수를 넣고 빼며 AIC(또는 p-value 기준)로 “가장 잘 맞는 모델”을 자동으로 고르는 방식이다. 이런 방법이 쓰이는 이유는 이해할 수 있다. 연구자는 “너무 많은 변수를 넣어 불안정해지는 것”을 피하고 싶고, 독자는 “최종 모델이 뭔지”를 보고 싶어한다.</p>
<p>이 과정에서 “p-value 기준으로 너무 많은 변수를 테스트했으니 다중비교 보정(FDR 등)을 해야 하는 것 아닌가?”라는 질문이 자연스럽게 따라온다. 하지만 confounder 선택의 핵심 문제는 “유의성 검정의 엄격함”이 아니다. p-value를 더 보수적으로 만든다고 해서, 인과추정에 해로운 변수가 안전해지는 것도 아니고, 반대로 중요한 confounder가 자동으로 살아남는 것도 아니다. 특히 표본이 크면 작은 차이도 쉽게 유의해지고, 표본이 작으면 중요한 교란이 유의하지 않게 보이기도 한다.</p>
<p>더 근본적으로, confounding은 “그 변수가 결과를 잘 예측하는가?”가 아니라 “치료/노출과 결과 사이의 비교를 왜곡하는 경로를 닫는가?”의 문제다. 어떤 변수는 결과 예측력은 약해 보여도(유의하지 않아도) 치료와 결과에 동시에 관련되어 편향을 크게 만들 수 있고, 반대로 결과와 강하게 관련되어 매우 유의해도(예측자여도) collider/매개변수라면 조정하는 순간 편향을 만든다.</p>
<p>즉, 이런 절차가 공통적으로 “예측이 잘 되는 변수”를 선호한다는 점이 문제의 출발점이다. 그리고 예측이 잘 되는 변수 중에는, 인과추정에 넣는 순간 오히려 편향을 만드는 변수가 있다. 대표적인 것이 collider다.</p>
<hr></section><section id="collider가-왜-위험한가-hba1c-예시로-연결하기" class="level2"><h2 class="anchored" data-anchor-id="collider가-왜-위험한가-hba1c-예시로-연결하기">3. Collider가 왜 위험한가: HbA1c 예시로 연결하기</h2>
<p>collider는 DAG에서 두 화살표가 한 변수로 “충돌”하는 구조다.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"></figure><p></p>
<div>
<pre class="mermaid mermaid-js">graph LR
S[Smoking] --&gt; H[Heart disease]
U[Unmeasured metabolic risk] --&gt; H
U --&gt; A[HbA1c]
S --&gt; A
</pre>
</div>
<p></p>
</div>
</div>
</div>
<p>이 그림에서 heart disease(<span class="math inline">\(H\)</span>)는 흡연(<span class="math inline">\(S\)</span>)과 관측되지 않은 대사 위험도(<span class="math inline">\(U\)</span>)의 “공통 결과”다. <span class="math inline">\(U\)</span>는 HbA1c(<span class="math inline">\(A\)</span>)에도 영향을 준다. 이때 heart disease를 조정하거나, “심장병이 있는 사람만” 분석하면 <span class="math inline">\(S \rightarrow H \leftarrow U \rightarrow A\)</span> 경로가 열려서 흡연과 HbA1c 사이의 관계가 왜곡될 수 있다.</p>
<p>현장에서 이 오류가 생기는 전형적인 장면은 다음과 같다. 심장병은 예후적으로 중요하고, 데이터에도 잘 기록되어 있으며, 결과(HbA1c)와도 강하게 연관된다. 그래서 p-value screening이나 stepwise selection은 심장병 변수를 쉽게 “좋은 공변량”으로 선택한다. 하지만 그 변수가 collider라면, 그 순간 인과추정은 삐끗한다.</p>
<p>말로만 들으면 직관이 약하니, 시뮬레이션으로 확인해보자.</p>
<hr></section><section id="r-시뮬레이션-전통적-선택이-collider를-끼워-넣는-순간" class="level2"><h2 class="anchored" data-anchor-id="r-시뮬레이션-전통적-선택이-collider를-끼워-넣는-순간">4. R 시뮬레이션: 전통적 선택이 collider를 끼워 넣는 순간</h2>
<p>아래 시뮬레이션은 “흡연이 HbA1c를 약간 올린다(진짜 효과는 +0.20)”를 진실로 설정하고, 나이·성별·운동·식습관·음주 같은 기본 특성은 흡연과 HbA1c 모두에 영향을 주는 교란변수로 만든다. 그리고 heart disease는 흡연과 관측되지 않은 대사 위험도(<span class="math inline">\(U\)</span>)에 의해 생기는 collider로 설정한다.</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">20260104</span><span class="op">)</span></span>
<span></span>
<span><span class="va">coef_ci</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">fit</span>, <span class="va">term</span> <span class="op">=</span> <span class="st">"smoking"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">co</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">est</span> <span class="op">&lt;-</span> <span class="va">co</span><span class="op">[</span><span class="va">term</span>, <span class="st">"Estimate"</span><span class="op">]</span></span>
<span>  <span class="va">se</span> <span class="op">&lt;-</span> <span class="va">co</span><span class="op">[</span><span class="va">term</span>, <span class="st">"Std. Error"</span><span class="op">]</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>estimate <span class="op">=</span> <span class="va">est</span>, lo <span class="op">=</span> <span class="va">est</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">se</span>, hi <span class="op">=</span> <span class="va">est</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">se</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100000</span></span>
<span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">60</span>, sd <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">sex</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span> <span class="co"># 1=male</span></span>
<span></span>
<span><span class="va">activity</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>  <span class="co"># 높을수록 활동적</span></span>
<span><span class="va">diet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span>      <span class="co"># 높을수록 식습관 양호</span></span>
<span><span class="va">alcohol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.3</span> <span class="op">+</span> <span class="fl">0.02</span> <span class="op">*</span> <span class="op">(</span><span class="va">age</span> <span class="op">-</span> <span class="fl">60</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.2</span> <span class="op">*</span> <span class="va">sex</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 관측되지 않은 대사 위험도 (유전/비만/염증/사회경제 등)</span></span>
<span><span class="va">u</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 흡연(노출): 기본 특성에 의해 선택(교란 존재)</span></span>
<span><span class="va">smoking</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span></span>
<span>  <span class="va">n</span>, <span class="fl">1</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.2</span> <span class="op">+</span> <span class="fl">0.03</span> <span class="op">*</span> <span class="op">(</span><span class="va">age</span> <span class="op">-</span> <span class="fl">60</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> <span class="va">sex</span> <span class="op">+</span> <span class="fl">0.4</span> <span class="op">*</span> <span class="va">alcohol</span> <span class="op">-</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">activity</span> <span class="op">-</span> <span class="fl">0.3</span> <span class="op">*</span> <span class="va">diet</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Outcome: HbA1c</span></span>
<span><span class="va">true_tau</span> <span class="op">&lt;-</span> <span class="fl">0.20</span></span>
<span><span class="va">hba1c</span> <span class="op">&lt;-</span> <span class="fl">6.8</span> <span class="op">+</span></span>
<span>  <span class="va">true_tau</span> <span class="op">*</span> <span class="va">smoking</span> <span class="op">+</span></span>
<span>  <span class="fl">0.03</span> <span class="op">*</span> <span class="op">(</span><span class="va">age</span> <span class="op">-</span> <span class="fl">60</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fl">0.10</span> <span class="op">*</span> <span class="va">sex</span> <span class="op">+</span></span>
<span>  <span class="fl">0.12</span> <span class="op">*</span> <span class="va">alcohol</span> <span class="op">-</span></span>
<span>  <span class="fl">0.12</span> <span class="op">*</span> <span class="va">activity</span> <span class="op">-</span></span>
<span>  <span class="fl">0.10</span> <span class="op">*</span> <span class="va">diet</span> <span class="op">+</span></span>
<span>  <span class="fl">0.80</span> <span class="op">*</span> <span class="va">u</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">0.6</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Collider: 심혈관질환은 smoking과 u의 공통 결과</span></span>
<span><span class="va">heart_disease</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html">plogis</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3.2</span> <span class="op">+</span> <span class="fl">2.0</span> <span class="op">*</span> <span class="va">smoking</span> <span class="op">+</span> <span class="fl">2.0</span> <span class="op">*</span> <span class="va">u</span> <span class="op">+</span> <span class="fl">0.04</span> <span class="op">*</span> <span class="op">(</span><span class="va">age</span> <span class="op">-</span> <span class="fl">60</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> <span class="va">alcohol</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">sex</span>, <span class="va">activity</span>, <span class="va">diet</span>, <span class="va">alcohol</span>, <span class="va">smoking</span>, <span class="va">heart_disease</span>, <span class="va">hba1c</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_naive</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">hba1c</span> <span class="op">~</span> <span class="va">smoking</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span><span class="va">fit_knowledge</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">hba1c</span> <span class="op">~</span> <span class="va">smoking</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">activity</span> <span class="op">+</span> <span class="va">diet</span> <span class="op">+</span> <span class="va">alcohol</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span><span class="va">fit_plus_collider</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">hba1c</span> <span class="op">~</span> <span class="va">smoking</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">activity</span> <span class="op">+</span> <span class="va">diet</span> <span class="op">+</span> <span class="va">alcohol</span> <span class="op">+</span> <span class="va">heart_disease</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="fu">coef_ci</span><span class="op">(</span><span class="va">fit_naive</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"naive"</span><span class="op">)</span>,</span>
<span>  <span class="fu">coef_ci</span><span class="op">(</span><span class="va">fit_knowledge</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"knowledge-driven adjustment"</span><span class="op">)</span>,</span>
<span>  <span class="fu">coef_ci</span><span class="op">(</span><span class="va">fit_plus_collider</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"knowledge + collider"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>true_tau <span class="op">=</span> <span class="va">true_tau</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">estimate</span>, <span class="va">lo</span>, <span class="va">hi</span>, <span class="va">true_tau</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  model                       estimate      lo       hi true_tau
  &lt;chr&gt;                          &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 naive                         0.391   0.378   0.404        0.2
2 knowledge-driven adjustment   0.205   0.192   0.218        0.2
3 knowledge + collider         -0.0161 -0.0284 -0.00393      0.2</code></pre>
</div>
</div>
<p>여기서 <code>knowledge-driven adjustment</code>는 “치료 이전에 측정되는 기본 특성”만 조정한다. 반대로 <code>knowledge + collider</code>는 심혈관질환을 추가로 조정한다. 이 차이로 인해 효과가 단순히 약해지는 수준을 넘어, 상황에 따라서는 <strong>효과 방향(부호) 자체가 바뀔 수도</strong> 있음을 확인할 수 있다.</p>
<hr></section><section id="전통적-절차를-그대로-따라하면스크리닝stepwise-무슨-일이-생길까" class="level2"><h2 class="anchored" data-anchor-id="전통적-절차를-그대로-따라하면스크리닝stepwise-무슨-일이-생길까">5. 전통적 절차를 그대로 따라하면(스크리닝/stepwise) 무슨 일이 생길까?</h2>
<p>이제 흔한 관행을 그대로 흉내 내보자. 첫 번째는 univariate screening이고, 두 번째는 forward/backward stepwise(AIC)다. 둘 다 결과를 잘 설명하는 변수를 선호하므로, heart disease처럼 결과와 강하게 연관된 변수가 있으면 쉽게 포함될 수 있다.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">candidate_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"sex"</span>, <span class="st">"activity"</span>, <span class="st">"diet"</span>, <span class="st">"alcohol"</span>, <span class="st">"heart_disease"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># (1) univariate screening: hba1c ~ smoking + x 에서 x의 p-value로 선택</span></span>
<span><span class="va">pvals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_dbl</a></span><span class="op">(</span><span class="va">candidate_vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">v</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"hba1c ~ smoking + "</span>, <span class="va">v</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">f</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="va">v</span>, <span class="st">"Pr(&gt;|t|)"</span><span class="op">]</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">pvals</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">candidate_vars</span></span>
<span><span class="va">selected</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">pvals</span><span class="op">)</span><span class="op">[</span><span class="va">pvals</span> <span class="op">&lt;</span> <span class="fl">0.1</span><span class="op">]</span></span>
<span><span class="va">selected</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "age"           "sex"           "activity"      "diet"         
[5] "alcohol"       "heart_disease"</code></pre>
</div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fit_screened</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"hba1c ~ smoking +"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">selected</span>, collapse <span class="op">=</span> <span class="st">" + "</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># (2) stepwise (forward/backward, AIC)</span></span>
<span><span class="va">fit_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">hba1c</span> <span class="op">~</span> <span class="va">smoking</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">activity</span> <span class="op">+</span> <span class="va">diet</span> <span class="op">+</span> <span class="va">alcohol</span> <span class="op">+</span> <span class="va">heart_disease</span>, data <span class="op">=</span> <span class="va">df</span><span class="op">)</span></span>
<span><span class="va">fit_step</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/step.html">step</a></span><span class="op">(</span><span class="va">fit_full</span>, direction <span class="op">=</span> <span class="st">"both"</span>, trace <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">formula</a></span><span class="op">(</span><span class="va">fit_step</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>hba1c ~ smoking + age + sex + activity + diet + alcohol + heart_disease</code></pre>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="fu">coef_ci</span><span class="op">(</span><span class="va">fit_knowledge</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"knowledge-driven adjustment"</span><span class="op">)</span>,</span>
<span>  <span class="fu">coef_ci</span><span class="op">(</span><span class="va">fit_screened</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"p-value screening"</span><span class="op">)</span>,</span>
<span>  <span class="fu">coef_ci</span><span class="op">(</span><span class="va">fit_step</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"stepwise (AIC)"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>true_tau <span class="op">=</span> <span class="va">true_tau</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">estimate</span>, <span class="va">lo</span>, <span class="va">hi</span>, <span class="va">true_tau</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  model                       estimate      lo       hi true_tau
  &lt;chr&gt;                          &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 knowledge-driven adjustment   0.205   0.192   0.218        0.2
2 p-value screening            -0.0161 -0.0284 -0.00393      0.2
3 stepwise (AIC)               -0.0161 -0.0284 -0.00393      0.2</code></pre>
</div>
</div>
<p>이 실험에서 핵심은 “어떤 변수가 선택되는가”다. heart disease는 결과(HbA1c)와 강하게 연관되기 때문에, 스크리닝/stepwise에서 자주 살아남는다. 그런데 heart disease가 collider라면, “유의한 공변량을 잘 골랐다”는 직감과 달리 흡연 효과 추정이 0에 가까워지거나 심지어 반대 방향으로 왜곡될 수 있다.</p>
<p>아래 그림은 각 접근이 추정한 흡연 효과를 한눈에 비교한 것이다. (진짜 효과는 +0.20으로 설정했다.)</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">est_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="fu">coef_ci</span><span class="op">(</span><span class="va">fit_naive</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"naive"</span><span class="op">)</span>,</span>
<span>  <span class="fu">coef_ci</span><span class="op">(</span><span class="va">fit_knowledge</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"knowledge-driven"</span><span class="op">)</span>,</span>
<span>  <span class="fu">coef_ci</span><span class="op">(</span><span class="va">fit_plus_collider</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"knowledge + collider"</span><span class="op">)</span>,</span>
<span>  <span class="fu">coef_ci</span><span class="op">(</span><span class="va">fit_screened</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"p-value screening"</span><span class="op">)</span>,</span>
<span>  <span class="fu">coef_ci</span><span class="op">(</span><span class="va">fit_step</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="st">"stepwise (AIC)"</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">model</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">est_tbl</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">estimate</span>, y <span class="op">=</span> <span class="va">model</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">true_tau</span>, linetype <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_linerange.html">geom_pointrange</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">lo</span>, xmax <span class="op">=</span> <span class="va">hi</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Estimated effect of smoking on HbA1c"</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<hr></section><section id="결론-가장-이상적인-접근은-knowledge-driven이다" class="level2"><h2 class="anchored" data-anchor-id="결론-가장-이상적인-접근은-knowledge-driven이다">6. 결론: 가장 이상적인 접근은 knowledge-driven이다</h2>
<p>인과추론에서 confounder 선택은 통계적 ’모형 선택’이 아니라, <strong>시간축과 지식에 기반한 설계 선택</strong>이어야 한다. 가능한 한 치료(노출) 이전에 측정된 변수만 후보로 두고, 임상/역학적 지식으로 인과 구조를 정리한 뒤(DAG), backdoor path를 닫는 조정 집합을 명시하는 것이 출발점이다. 예후가 중요해 보이는 변수라도 그것이 치료 이후 변수이거나 collider 가능성이 있다면(예: 합병증, 입원, 검사 시행, 중증도 지표 등), 조정에 포함시키는 순간 편향이 새로 생길 수 있음을 항상 염두에 두는 편이 안전하다.</p>
<p>그리고 평균 효과 한 줄로 끝내기 전에, 효과 이질성(예: 나이/성별/생활습관에 따른 차이)을 확인하는 습관도 중요하다. ITE는 정의상 직접 관측되지 않지만, CATE처럼 “조건부 평균 효과”는 현실 데이터에서 훨씬 실용적인 형태로 접근할 수 있다. 결국 “무엇을 보정할 것인가”는 곧 “무엇을 알고 싶은가”와 연결되고, 그 질문을 정확히 고정하는 것에서 인과추론이 시작된다.</p>
<p>다음 글에서는 DAG를 이용해 조정 집합을 고르는 실전적인 규칙들과(예: backdoor criterion, time ordering) 현실 데이터에서 collider/mediator 후보를 구별하는 감각을 더 구체적으로 다뤄보겠다.</p>


</section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{jo2026,
  author = {Jo, Hyungwoo},
  title = {Causal {Inference} (3): {Confounder} {Selection} \&amp;
    {Collider} {Bias}},
  date = {2026-01-04},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-jo2026" class="csl-entry quarto-appendix-citeas" role="listitem">
Jo, Hyungwoo. 2026. <span>“Causal Inference (3): Confounder Selection
&amp; Collider Bias.”</span> January 4, 2026.
</div></div></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>