[
  {
    "objectID": "posts/2025-01-03-comeptingrisk/index.html",
    "href": "posts/2025-01-03-comeptingrisk/index.html",
    "title": "Competing Risk Analysis",
    "section": "",
    "text": "경쟁 위험(Competing risk)은 한 종류의 이벤트가 발생하면 다른 이벤트가 발생할 수 없는 상황으로 정의됩니다. 예를 들어, 암 재발이 event of interest 인 경우 사망이 competing risk로 작용할 수 있습니다 (사망한 암 환자에게는 암 재발이라는 event가 발생 할 수 없기 때문). 경쟁 위험을 무시하면 모집단의 생존 함수나 이벤트 발생률을 과대 혹은 과소평가 할 위험이 생기기에 이를 고려한 분석이 필요한 경우들이 있습니다. 여러 상황들을 살펴보고, 어떤 지표들을 이용했을 때 어떤 해석이 가능한지 알아보도록 하겠습니다.\n\n\n\\[\nS(t) = \\prod_{i: t_i \\leq t} \\left(1 - \\frac{d_i}{n_i}\\right)\n\\]\n\nS(t): 생존 함수\n\n\\(t_i\\): 사건 발생 시점\n\n\\(d_i\\): 시점 \\(t_i\\)에서 발생한 사건 수\n\n\\(n_i\\): 시점 \\(t_i\\)에서 위험에 노출된 대상 수\n\n결국 생존 함수란 각 사건 발생 시점에서의 생존 확률(어떤 이벤트도 발생하지 않을 확률)을 누적 곱하여 계산한 시간 \\(t\\)까지 생존할 확률을 뜻합니다.\n\n\n\n\n\\[\nh_k(t) = \\lim_{\\Delta t \\to 0} \\frac{P(t \\leq T &lt; t + \\Delta t, \\epsilon = k \\mid T \\geq t)}{\\Delta t}\n\\]\n\n\\(\\lambda_k(t)\\): 이벤트 유형 \\(k\\)의 원인별 위험 함수\n\nT: 이벤트 발생 시간\n\n\\(\\epsilon\\): 이벤트 유형 지표(Ex. \\(\\epsilon\\) = 1: event of interest, \\(\\epsilon\\) = 2: competing risk )\n결국 위험 함수란 각 시점에서 event k 가 발생할 확률을 뜻합니다.\n\n\n\n\n\\[\nCIF_k(t) = \\int_{0}^{t} h_k(u) S(u) \\, du\n\\]\n이벤트 k에 대한 누적발생률 함수란 결국 시점 마다 생존해 있을 확률 \\(S(t)\\) 와 그 시점 에서 k가 발생할 위험 \\(h_k(t)\\)를 곱하여 합산한 값으로, 시점 t에 이번트 k의 누적 발생률을 뜻하게 됩니다.\n\n\n\n경쟁 위험이 없는 생존 분석에서는 대게 Kaplan-Meier 추정치를 사용하지만, 이는 앞서 말했던 예시와 같이 이벤트 발생률을 과대 혹은 과소 평가할 위험이 있기 때문에 경쟁 위험이 있는 경우 적합하지 않은 경우가 많습니다. 암 재발과 사망의 예시를 생각해보겠습니다. Kaplan-Meier 추정치의 경우 사망한 환자의 경우 censoring 된 것으로 처리가 되어 “이 환자의 경우 이후 정보는 알 수 없다”고 간주를 하고 계산하는 추정치입니다. 하지만, 현실에서는 사망한 환자의 경우 이후 암 재발이 일어날 가능성이 0이라는 것을 알 수 있습니다. 반면 CIF의 경우 수식에서도 볼 수 있듯이 사망이 발생해버린 사람은 이미 사건이 발생한 상태로 처리가 되며, 경쟁 이벤트가 발생했다는 \\(CIF_2(t)\\)라는 누적발생률 함수에 따로 기록되고 있는 것을 알 수 있습니다."
  },
  {
    "objectID": "posts/2025-01-03-comeptingrisk/index.html#생존-함수",
    "href": "posts/2025-01-03-comeptingrisk/index.html#생존-함수",
    "title": "Competing Risk Analysis",
    "section": "",
    "text": "\\[\nS(t) = \\prod_{i: t_i \\leq t} \\left(1 - \\frac{d_i}{n_i}\\right)\n\\]\n\nS(t): 생존 함수\n\n\\(t_i\\): 사건 발생 시점\n\n\\(d_i\\): 시점 \\(t_i\\)에서 발생한 사건 수\n\n\\(n_i\\): 시점 \\(t_i\\)에서 위험에 노출된 대상 수\n\n결국 생존 함수란 각 사건 발생 시점에서의 생존 확률(어떤 이벤트도 발생하지 않을 확률)을 누적 곱하여 계산한 시간 \\(t\\)까지 생존할 확률을 뜻합니다."
  },
  {
    "objectID": "posts/2025-01-03-comeptingrisk/index.html#위험-함수",
    "href": "posts/2025-01-03-comeptingrisk/index.html#위험-함수",
    "title": "Competing Risk Analysis",
    "section": "",
    "text": "\\[\nh_k(t) = \\lim_{\\Delta t \\to 0} \\frac{P(t \\leq T &lt; t + \\Delta t, \\epsilon = k \\mid T \\geq t)}{\\Delta t}\n\\]\n\n\\(\\lambda_k(t)\\): 이벤트 유형 \\(k\\)의 원인별 위험 함수\n\nT: 이벤트 발생 시간\n\n\\(\\epsilon\\): 이벤트 유형 지표(Ex. \\(\\epsilon\\) = 1: event of interest, \\(\\epsilon\\) = 2: competing risk )\n결국 위험 함수란 각 시점에서 event k 가 발생할 확률을 뜻합니다."
  },
  {
    "objectID": "posts/2025-01-03-comeptingrisk/index.html#누적발생률-함수cif",
    "href": "posts/2025-01-03-comeptingrisk/index.html#누적발생률-함수cif",
    "title": "Competing Risk Analysis",
    "section": "",
    "text": "\\[\nCIF_k(t) = \\int_{0}^{t} h_k(u) S(u) \\, du\n\\]\n이벤트 k에 대한 누적발생률 함수란 결국 시점 마다 생존해 있을 확률 \\(S(t)\\) 와 그 시점 에서 k가 발생할 위험 \\(h_k(t)\\)를 곱하여 합산한 값으로, 시점 t에 이번트 k의 누적 발생률을 뜻하게 됩니다."
  },
  {
    "objectID": "posts/2025-01-03-comeptingrisk/index.html#왜-경쟁-위험-분석에서-cif를-사용할까",
    "href": "posts/2025-01-03-comeptingrisk/index.html#왜-경쟁-위험-분석에서-cif를-사용할까",
    "title": "Competing Risk Analysis",
    "section": "",
    "text": "경쟁 위험이 없는 생존 분석에서는 대게 Kaplan-Meier 추정치를 사용하지만, 이는 앞서 말했던 예시와 같이 이벤트 발생률을 과대 혹은 과소 평가할 위험이 있기 때문에 경쟁 위험이 있는 경우 적합하지 않은 경우가 많습니다. 암 재발과 사망의 예시를 생각해보겠습니다. Kaplan-Meier 추정치의 경우 사망한 환자의 경우 censoring 된 것으로 처리가 되어 “이 환자의 경우 이후 정보는 알 수 없다”고 간주를 하고 계산하는 추정치입니다. 하지만, 현실에서는 사망한 환자의 경우 이후 암 재발이 일어날 가능성이 0이라는 것을 알 수 있습니다. 반면 CIF의 경우 수식에서도 볼 수 있듯이 사망이 발생해버린 사람은 이미 사건이 발생한 상태로 처리가 되며, 경쟁 이벤트가 발생했다는 \\(CIF_2(t)\\)라는 누적발생률 함수에 따로 기록되고 있는 것을 알 수 있습니다."
  },
  {
    "objectID": "posts/2025-01-03-comeptingrisk/index.html#fine-gray-method",
    "href": "posts/2025-01-03-comeptingrisk/index.html#fine-gray-method",
    "title": "Competing Risk Analysis",
    "section": "Fine-Gray Method",
    "text": "Fine-Gray Method\n경쟁위험이 존재하는 경우 생존 함수인 \\(S(t)\\)가 \\(1-CIF(t)\\)로 치환되지 않기 때문에 전통적 위험함수로는 \\(CIF(t)\\)를 추정할 수 없다는 한계가 있습니다. (\\(S(t)+CIF_1(t)+CIF_2(t)+....+CIF_k(t)=1\\)이기 때문) 따라서, Fine-Gray Method 에서는 \\(1-CIF(t)\\)의 시간에 따른 변화량을 추적하는 함수인 Subdistribution hazard function을 새로 추정합니다.\n하위 분포 위험의 경우 아래의 식과 같이 계산할 수 있습니다. \\[\nh_k^{sd}(t)\n\\;=\\;\n-\\,\\frac{d}{dt} \\,\\ln\\!\\bigl\\{1 - CIF_k(t)\\bigr\\}\n\\;=\\;\n\\frac{h_k^{cs}(t) S(t)}{\\,1 - CIF_k(t)\\,}.\n\\] 하위 분포 위험의 경우 \\(h_k^{sd}(t)\\)로 표기를 하고 이는 \\(CIF_k(t)\\)의 변화량을 추정할 수 있는 위험 함수입니다. 또한 여기서 \\(h_k^{cs}(t)\\)의 경우 cause-specific hazard function으로, 앞서 정의한 위험함수와 같은 의미를 가집니다.(subdistrivution hazard function과 구분하기 위해 이렇게 지칭하도록 하겠습니다). 그렇다면 \\(h_k^{sd}(t)\\)는 어떻게 해석을 할 수 있을지 알아보겠습니다. 우선 \\(S(t)\\)가 \\(1-CIF(t)\\)로 치환이 되는 경쟁위험이 없는 상황에서는 cause-specific hazard function과 완전히 동일하다는 것을 알 수 있습니다. 하지만 그렇지 않은 경우 cause-specific hazard function에 \\(\\frac {S(t)}{\\,1 - CIF_k(t)\\,}\\)을 곱한 값이 된다는 것을 알 수 있고, 이는 관심 event가 발생하지 않은 모든 사람이 분모 즉, risk set에 포함된다는 것을 알 수 있습니다. 이는 곧 아래의 수식으로 표현될 수 있습니다.\n\\[\nh_k^{sd}(t) = \\lim_{\\Delta t \\to 0} \\frac{P(t \\leq T &lt; t+\\Delta t, \\text{Cause} = k \\mid T \\geq t \\cup \\text{(Cause } \\neq k \\text{ 발생)})}{\\Delta t}\n\\] 예를 들어, event of interest가 암의 재발이고 comepting risk가 사망인 경우 전통적 생존 분석에서는 시간 t에서 살아 있는 환자들이 risk set이 된다면 subdistribution hazard function 에서는 시간 t에서 살아있는 사람들과 시간 t전에 competing risk를 경험한(사망한)사람들 또한 risk set에 포함된다는 차이가 있습니다. Fine-Gray Method에서는 이 subdistribution hazard function을 이용하여 \\(\\beta\\)값을 추정하여 \\(CIF(t)\\)에 대한 보다 직접적인 추정을 가능하게 하는 방법입니다. Fine-Gray Method 분석법을 실행하는 방법과 전통적 생존 분석과 어떻게 비교하여 어떻게 수치들을 해석할 수 있는지를 알아보겠습니다."
  },
  {
    "objectID": "posts/2025-01-03-comeptingrisk/index.html#fine-gray-method-와-전통적-생존함수-비교",
    "href": "posts/2025-01-03-comeptingrisk/index.html#fine-gray-method-와-전통적-생존함수-비교",
    "title": "Competing Risk Analysis",
    "section": "Fine-Gray Method 와 전통적 생존함수 비교",
    "text": "Fine-Gray Method 와 전통적 생존함수 비교\n다음과 같은 상황을 한번 생각해보겠습니다. 심부전 환자에서 중증 우울증 진단 여부에 따른 심장질환 관련 사망여부가 달라지는지 관심이 있는 상황을 가정해보겠습니다. 이 경우 CVD death가 Event of Interest가 되고 non-CVD death가 Competing risk가 될 것입니다. (non-CVD death로 사망하는 경우 심장 질환 관련 사망으로 사망하는지 관찰할 수 없기 때문). 우울증 진단 여부가 심장 질환 관련 사망에 관련이 없지만, 자살율을 크게 증가시켜 non-CVD death를 많이 발생시킨다고 한번 가정해보도록 하겠습니다. 가정에 따라 데이터를 한번 만들어보겠습니다.\n\nN &lt;- 10000\n# 우울증 여부를 배정\nDepression_status &lt;- c(rep(0, N/2), rep(1, N/2))\n#임의로 성별 배정\nSex &lt;- sample(c(0,1), size = N, replace = TRUE)\n\n# hazard를 가정에 맞게 정의\nlambda_cvd &lt;- 0.2  # CVD death 여부는 우울증과 무관하게 매년 0.2\nlambda_non_cvd_no_depression &lt;- 0.1  # Non-CVD death의 경우 비우울증 인구에서는 0.1\nlambda_non_cvd_depression &lt;- 0.5      # Non-CVD death rate가 자살율의 증가로 인해 우울증 인구에서 0.5\n\nCVD_time &lt;- numeric(N)\nnon_CVD_time &lt;- numeric(N)\nTime &lt;- numeric(N)\nEvent &lt;- numeric(N)\n\n# Simulate times\nfor (i in 1:N) {\n\n  CVD_time[i] &lt;- rexp(1, rate = lambda_cvd)\n  \n  if (Depression_status[i] == 0) {\n    non_CVD_time[i] &lt;- rexp(1, rate = lambda_non_cvd_no_depression)\n  } else {\n    non_CVD_time[i] &lt;- rexp(1, rate = lambda_non_cvd_depression)\n  }\n  if (CVD_time[i] &lt; non_CVD_time[i]) {\n    Time[i] &lt;- CVD_time[i]\n    Event[i] &lt;- 1  \n  } else {\n    Time[i] &lt;- non_CVD_time[i]\n    Event[i] &lt;- 2  \n  }\n}\n\nsample_data &lt;- data.frame(\n  ID = 1:N,\n  Time = round(Time, 2),\n  Event = Event,\n  Sex = ifelse(Sex == 1, \"Male\", \"Female\"),\n  Depression = ifelse(Depression_status == 1, \"Yes\", \"No\"),\n  CVD_time = round(CVD_time, 2)  \n)\n\nhead(sample_data, n= 15)\n\n   ID Time Event    Sex Depression CVD_time\n1   1 4.96     1 Female         No     4.96\n2   2 0.92     1 Female         No     0.92\n3   3 1.48     1   Male         No     1.48\n4   4 0.09     1   Male         No     0.09\n5   5 0.66     2 Female         No    14.27\n6   6 0.03     1   Male         No     0.03\n7   7 1.00     1   Male         No     1.00\n8   8 0.47     1   Male         No     0.47\n9   9 1.70     1   Male         No     1.70\n10 10 2.36     1 Female         No     2.36\n11 11 8.27     2   Male         No    17.14\n12 12 1.45     1 Female         No     1.45\n13 13 9.71     1 Female         No     9.71\n14 14 0.81     1 Female         No     0.81\n15 15 8.30     1 Female         No     8.30\n\n\n데이터에서 Time은 Death(CVD, non-CVD 포함)가 발생한 시점입니다. R의 cmprsk 패키지를 통해 fine gray method로 분석을 진행하고, 전통적 생존 분석또한 함께 진행해보겠습니다.\n\nlibrary(dplyr);library(survival);library(jstable)\nsample_data &lt;- sample_data %&gt;%\n  mutate(\n    Sex_num = ifelse(Sex == \"Male\", 1, 0),\n    Depression_num = ifelse(Depression == \"Yes\", 1, 0)\n  ) \nsurv_object_csh &lt;- Surv(time = sample_data$Time, event = sample_data$Event == 1)\ncox_csh &lt;- coxph(surv_object_csh ~ Depression_num, data = sample_data)\ncox2.display(cox_csh)\n\n$table\n               HR(95%CI)          P value\nDepression_num \"1.02 (0.95,1.09)\" \"0.562\"\n\n$metric\n                        [,1] [,2]\n&lt;NA&gt;                      NA   NA\nNo. of observations 10000.00   NA\nNo. of events        4784.00   NA\nAIC                 77070.23   NA\n\n$caption\n[1] \"Cox model on time ('NA') to event ('NA')\"\n\n\nexp(coef= beta)즉 Hazard ratio가 1이고 p-value가 0.936으로, 우울증 여부가 CVD-death에 영향을 미치지 않는 다는 것을 알 수 있습니다. 이는 데이터를 만들때의 가정과 동일하기 때문에 전통적 생존분석은 이를 잘 반영한다는 것을 알 수 있습니다. 이번엔 competing risk를 고려한 fine gray method로 분석을 해보겠습니다.\n\nlibrary(cmprsk)\nftime &lt;- sample_data$Time\nfstatus &lt;- sample_data$Event\ncovariates &lt;- sample_data %&gt;% select(Depression_num)\nfg_model &lt;- crr(ftime = ftime, fstatus = fstatus, cov1 = covariates)\nsummary(fg_model)\n\nCompeting Risks Regression\n\nCall:\ncrr(ftime = ftime, fstatus = fstatus, cov1 = covariates)\n\n                coef exp(coef) se(coef)     z p-value\nDepression_num -1.03     0.357   0.0331 -31.1       0\n\n               exp(coef) exp(-coef)  2.5% 97.5%\nDepression_num     0.357        2.8 0.335 0.381\n\nNum. cases = 10000\nPseudo Log-likelihood = -42093 \nPseudo likelihood ratio test = 1166  on 1 df,\n\n\nexp(coef) 즉 subdistribution hazard ratio가 0.363이고, p value 가 &lt;0.01임으로 우울증이 있는 사람에게는 CVD-death가 덜 발생한다고 해석할 수 있습니다. 우울증 여부가 CVD-death에 영향을 미치지 않게 데이터를 만들었는데 왜 이런 결과가 나왔는지 그리고 서로 다르게 나온 두 결과를 각각 어떻게 해석해야 되는지를 알아보겠습니다. 우울증 환자와 비 우울증 환자에서 CVD-death에 대한 CIF를 한번 그려보도록 하겠습니다.\n\ngroup &lt;- sample_data$Depression_num\ncif_cvd &lt;- cuminc(ftime, fstatus, group = group, cencode = 0)\nplot(1, type = \"n\", xlab = \"Time (years)\", ylab = \"Cumulative Incidence\",\n     xlim = c(0, 15), ylim = c(0, 1),\n     main = \"Cumulative Incidence of CVD Death by Depression Status\")\nlines(cif_cvd[[1]]$time, cif_cvd[[1]]$est, col = \"blue\", lty = 1, lwd = 2)\nlines(cif_cvd[[2]]$time, cif_cvd[[2]]$est, col = \"purple\", lty = 1, lwd = 2)\n\nlegend(\"topright\", \n       legend = c(\"Non-Depression - CVD Death\", \"Depression - CVD Death\"),\n       col = c(\"blue\", \"purple\"),\n       lty = 1,\n       lwd = 2)\n\n\n\n\n\n\n\n\n우울증 여부가 CVD-death에 영향을 미치지 않는다 하더라고, 우울증 환자에게서 CVD-death가 덜 발생한다는 것을 관찰할 수 있습니다. 이는 우울증 환자에서 이미 non-CVD death를 경험하여 CVD-death를 경험할 수 없기 때문이라는 것을 CVD, non-CVD death에 대한 CIF로 알아볼 수 있습니다.\n\nplot(1, type = \"n\", xlab = \"Time (years)\", ylab = \"Cumulative Incidence\",\n     xlim = c(0, 15), ylim = c(0, 1),\n     main = \"Cumulative Incidence of CVD Death by Depression Status\")\nlines(cif_cvd[[1]]$time, cif_cvd[[1]]$est, col = \"blue\", lty = 1, lwd = 2)\nlines(cif_cvd[[2]]$time, cif_cvd[[2]]$est, col = \"red\", lty = 1, lwd = 2)\nlines(cif_cvd[[3]]$time, cif_cvd[[3]]$est, col = \"skyblue\", lty = 1, lwd = 2)\nlines(cif_cvd[[4]]$time, cif_cvd[[4]]$est, col = \"pink\", lty = 1, lwd = 2)\n\n\nlegend(\"topright\", \n       legend = c(\"Non-Depression - CVD Death\", \"Depression - CVD Death\", \n                  \"Non-Depression - Non-CVD Death\", \"Depression - Non-CVD Death\"),\n       col = c(\"blue\", \"red\", \"skyblue\", \"pink\"),\n       lty = 1, lwd = 2, bty = \"n\", cex = 0.8)\n\n\n\n\n\n\n\n\n실제로 Depression 군에서는 non-CVD death가 급격하게 많이 발생하여, CVD-death의 CIF가 낮게 나오고 있다는 것을 확인 할 수 있습니다. non-CVD death가 발생하지 않은 경우를 가정하여 만들어 놓은 CVD_time변수로 Depression군과 non-Depression 군의 CIF를 비교해보도록 하겠습니다.\n\nlibrary(cmprsk)\nftime &lt;- sample_data$CVD_time\nfstatus &lt;- 1\ngroup &lt;- sample_data$Depression_num\ncif_cvd &lt;- cuminc(ftime, fstatus, group = group, cencode = 0)\nplot(1, type = \"n\", xlab = \"Time (years)\", ylab = \"Cumulative Incidence\",\n     xlim = c(0, 15), ylim = c(0, 1),\n     main = \"Cumulative Incidence of CVD Death by Depression Status\")\nlines(cif_cvd[[1]]$time, cif_cvd[[1]]$est, col = \"blue\", lty = 1, lwd = 2)\nlines(cif_cvd[[2]]$time, cif_cvd[[2]]$est, col = \"purple\", lty = 1, lwd = 2)\n\nlegend(\"topright\", \n       legend = c(\"Non-Depression - CVD Death\", \"Depression - CVD Death\"),\n       col = c(\"blue\", \"purple\"),\n       lty = 1, lwd = 2, bty = \"n\", cex = 0.8)\n\n\n\n\n\n\n\n\n두개의 그래프가 거의 일치하는 것을 확인할 수 있습니다. 즉 Competing risk의 존재는, 실제로 우울증이 CVD death에 영향을 미치지 않더라고, CIF에는 변화를 줄 수 있다는 것을 확인할 수 있습니다."
  },
  {
    "objectID": "posts/2025-01-03-comeptingrisk/index.html#how-to-interpret",
    "href": "posts/2025-01-03-comeptingrisk/index.html#how-to-interpret",
    "title": "Competing Risk Analysis",
    "section": "How to Interpret",
    "text": "How to Interpret\n지금까지 얻은 정보를 종합하여, cause-specific hazard와 subdistribution hazard 함수가 각각 어떤 질문에 적합한지, 어떤 내용을 설명하는지 정리해보겠습니다. Cause-specific hazard function은 “A라는 변수가 실제로 B에 영향을 미치는가?”와 같은 원인적(etiologic) 질문에 더 적합한 함수입니다. 예를 들어, “우울증이 CVD 사망을 유발하는가?”라는 질문에 답하기 위해서는 cause-specific hazard function을 사용하는 것이 더 적절할 수 있습니다. 반면, subdistribution hazard ratio는 “우울증이 CVD 사망의 발생률에 어떤 영향을 미치는가?”와 같은 예후(prognostic) 질문에 더 적합한 함수입니다. 이는 subdistribution hazard ratio가 Cumulative Incidence Function (CIF)을 직접적으로 추정하기 때문에, CIF 함수와 긴밀하게 연관되어 있습니다. 따라서 예후를 예측하는 측면에서는 Fine-Gray 방법을 이용한 분석이, 원인을 분석하는 측면에서는 전통적인 생존 분석이 더 적절합니다. 두 분석 결과를 함께 고려함으로써, 경쟁 위험이 존재하는 상황에서 관심 있는 사건에 영향을 미치는 요인들에 대한 포괄적인 분석을 수행할 수 있습니다.\n\nPS. Censoring이 존재하는 경우\nSubdistribution hazard function을 살펴볼 때, censoring이 존재하지 않고 환자를 이벤트가 발생할 때까지 관찰할 수 있다는 가정(complete data로 통칭)하에 risk set이 정의가 되었습니다. Censoring이 존재하는 경우 risk set이 어떻게 존재하는지 알아보겠습니다. Complete data의 경우 competing risk가 발생한 환자도, 발생한 시점 외에도 계속 한명의 존재로 risk set에 남아있다는 것을, 앞선 subdistribution hazard function의 유도과정에서 살펴보았습니다. Censoring이 생기는 경우 IPCW(Inverse probability censor weighting)이라는 방법을 통해, censoring이 된 환자의 예후를 반영하는 방법을 fine-gray method에서 사용하고 있습니다. 시점 t에서 100명이 생존한 와중에 60명이 censoring되고 40명에게 event가 발생하거나, 관측되거나 했다고 가정해봅시다. Censoring이라는 과정이 환자의 event 발생여부나 baseline에 관계없이 발생한다는 가정이 있다면 남은 40명에게 각각 2.5배의 가중치를 준다면, censoring이 발생하지 않고 100명을 계속 관측하는 것과 동일한 결과를 얻을 수 있다는 것이 IPCW의 방법론입니다. 따라서 시점 t이전에 competing event가 발생한 사람의 경우 여전히 한명으로 risk set에 기여를 하게 되고, 시점 t에서 censoring된 사람들은 2.5배의 가중치를 받아 risk set과 event set에 반영이 됩니다. 즉 competing risk가 발생한 환자들의 경우 여전히 한명으로 risk set에 기여하지만, 실질적으로 기여하는 가중치는 적어진다는 것을 알 수 있습니다. 이를 반영한 것이 survival package의 finegray함수이며, 이를 이용하여 finegray method를 통한 분석 또한 가능합니다.\n\nlibrary(survival)\ndata &lt;- mgus2\ndata$etime &lt;- with(data, ifelse(pstat==0, futime, ptime))\ndata$event &lt;- with(data, ifelse(pstat==0, 2*death, 1))\ndata$event &lt;- factor(data$event, 0:2, labels=c(\"censor\", \"pcm\", \"death\"))\npdata &lt;- finegray(Surv(etime, event) ~ ., data=data)\nhead(pdata)\n\n  id age sex dxyr  hgb creat mspike ptime pstat futime death fgstart fgstop\n1  1  88   F 1981 13.1   1.3    0.5    30     0     30     1       0     35\n2  1  88   F 1981 13.1   1.3    0.5    30     0     30     1      35     44\n3  1  88   F 1981 13.1   1.3    0.5    30     0     30     1      44     47\n4  1  88   F 1981 13.1   1.3    0.5    30     0     30     1      48     52\n5  1  88   F 1981 13.1   1.3    0.5    30     0     30     1      53     56\n6  1  88   F 1981 13.1   1.3    0.5    30     0     30     1      56     57\n  fgstatus      fgwt\n1        0 1.0000000\n2        0 0.9990449\n3        0 0.9980368\n4        0 0.9959629\n5        0 0.9905896\n6        0 0.9873022\n\n\n데이터에서 볼 수 있듯이 competing risk가 발생한 환자의 경우 추적 종료까지 risk set에 기여도는 낮아지지만, 끝까지 포함되어 있다는 것을 알 수 있습니다. 또한 얻은 pdata로 기존의 생존분석과 같은 함수를 사용하면, 가중치가 반영되어 fine gray method로 구한 subdistribution hazard function에 대한 coefficient값을 얻을 수 있다는 것을 알 수 있습니다.\n\nfgfit &lt;- coxph(Surv(fgstart, fgstop, fgstatus) ~ age+sex,\n               weight=fgwt, data=pdata, model = T)\nsummary(fgfit)\n\nCall:\ncoxph(formula = Surv(fgstart, fgstop, fgstatus) ~ age + sex, \n    data = pdata, weights = fgwt, model = T)\n\n  n= 41775, number of events= 115 \n\n          coef exp(coef)  se(coef) robust se     z Pr(&gt;|z|)   \nage  -0.017302  0.982847  0.007022  0.005528 -3.13  0.00175 **\nsexM -0.259757  0.771239  0.187049  0.181707 -1.43  0.15285   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n     exp(coef) exp(-coef) lower .95 upper .95\nage     0.9828      1.017    0.9723    0.9936\nsexM    0.7712      1.297    0.5402    1.1012\n\nConcordance= 0.548  (se = 0.026 )\nLikelihood ratio test= 7.28  on 2 df,   p=0.03\nWald test            = 11.19  on 2 df,   p=0.004\nScore (logrank) test = 7.58  on 2 df,   p=0.02,   Robust = 9.28  p=0.01\n\n  (Note: the likelihood ratio and score tests assume independence of\n     observations within a cluster, the Wald and robust score tests do not)."
  },
  {
    "objectID": "posts/2025-01-03-comeptingrisk/index.html#ps.-censoring이-존재하는-경우",
    "href": "posts/2025-01-03-comeptingrisk/index.html#ps.-censoring이-존재하는-경우",
    "title": "Competing Risk Analysis",
    "section": "PS. Censoring이 존재하는 경우",
    "text": "PS. Censoring이 존재하는 경우\nSubdistribution hazard function을 살펴볼 때, censoring이 존재하지 않고 환자를 이벤트가 발생할 때까지 관찰할 수 있다는 가정(complete data로 통칭)하에 risk set이 정의가 되었습니다. Censoring이 존재하는 경우 risk set이 어떻게 존재하는지 알아보겠습니다. Complete data의 경우 competing risk가 발생한 환자도, 발생한 시점 외에도 계속 한명의 존재로 risk set에 남아있다는 것을, 앞선 subdistribution hazard function의 유도과정에서 살펴보았습니다. Censoring이 생기는 경우 IPCW(Inverse probability censor weighting)이라는 방법을 통해, censoring이 된 환자의 예후를 반영하는 방법을 fine-gray method에서 사용하고 있습니다. 시점 t에서 100명이 생존한 와중에 60명이 censoring되고 40명에게 event가 발생하거나, 관측되거나 했다고 가정해봅시다. Censoring이라는 과정이 환자의 event 발생여부나 baseline에 관계없이 발생한다는 가정이 있다면 남은 40명에게 각각 2.5배의 가중치를 준다면, censoring이 발생하지 않고 100명을 계속 관측하는 것과 동일한 결과를 얻을 수 있다는 것이 IPCW의 방법론입니다. 따라서 시점 t이전에 competing event가 발생한 사람의 경우 여전히 한명으로 risk set에 기여를 하게 되고, 시점 t에서 censoring된 사람들은 2.5배의 가중치를 받아 risk set과 event set에 반영이 됩니다. 즉 competing risk가 발생한 환자들의 경우 여전히 한명으로 risk set에 기여하지만, 실질적으로 기여하는 가중치는 적어진다는 것을 알 수 있습니다. 이를 반영한 것이 survival package의 finegray함수이며, 이를 이용하여 finegray method를 통한 분석 또한 가능합니다.\n\nlibrary(survival)\ndata &lt;- mgus2\ndata$etime &lt;- with(data, ifelse(pstat==0, futime, ptime))\ndata$event &lt;- with(data, ifelse(pstat==0, 2*death, 1))\ndata$event &lt;- factor(data$event, 0:2, labels=c(\"censor\", \"pcm\", \"death\"))\npdata &lt;- finegray(Surv(etime, event) ~ ., data=data)\nhead(pdata)\n\n  id age sex dxyr  hgb creat mspike ptime pstat futime death fgstart fgstop\n1  1  88   F 1981 13.1   1.3    0.5    30     0     30     1       0     35\n2  1  88   F 1981 13.1   1.3    0.5    30     0     30     1      35     44\n3  1  88   F 1981 13.1   1.3    0.5    30     0     30     1      44     47\n4  1  88   F 1981 13.1   1.3    0.5    30     0     30     1      48     52\n5  1  88   F 1981 13.1   1.3    0.5    30     0     30     1      53     56\n6  1  88   F 1981 13.1   1.3    0.5    30     0     30     1      56     57\n  fgstatus      fgwt\n1        0 1.0000000\n2        0 0.9990449\n3        0 0.9980368\n4        0 0.9959629\n5        0 0.9905896\n6        0 0.9873022\n\n\n데이터에서 볼 수 있듯이 competing risk가 발생한 환자의 경우 추적 종료까지 risk set에 기여도는 낮아지지만, 끝까지 포함되어 있다는 것을 알 수 있습니다. 또한 얻은 pdata로 기존의 생존분석과 같은 함수를 사용하면, 가중치가 반영되어 fine gray method로 구한 subdistribution hazard function에 대한 coefficient값을 얻을 수 있다는 것을 알 수 있습니다.\n\nfgfit &lt;- coxph(Surv(fgstart, fgstop, fgstatus) ~ age+sex,\n               weight=fgwt, data=pdata, model = T)\nsummary(fgfit)\n\nCall:\ncoxph(formula = Surv(fgstart, fgstop, fgstatus) ~ age + sex, \n    data = pdata, weights = fgwt, model = T)\n\n  n= 41775, number of events= 115 \n\n          coef exp(coef)  se(coef) robust se     z Pr(&gt;|z|)   \nage  -0.017302  0.982847  0.007022  0.005528 -3.13  0.00175 **\nsexM -0.259757  0.771239  0.187049  0.181707 -1.43  0.15285   \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n     exp(coef) exp(-coef) lower .95 upper .95\nage     0.9828      1.017    0.9723    0.9936\nsexM    0.7712      1.297    0.5402    1.1012\n\nConcordance= 0.548  (se = 0.026 )\nLikelihood ratio test= 7.28  on 2 df,   p=0.03\nWald test            = 11.19  on 2 df,   p=0.004\nScore (logrank) test = 7.58  on 2 df,   p=0.02,   Robust = 9.28  p=0.01\n\n  (Note: the likelihood ratio and score tests assume independence of\n     observations within a cluster, the Wald and robust score tests do not)."
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "Hyungwoo Jo\nInterested in Psychiatry and Statistics"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Blog",
    "section": "",
    "text": "Order By\n       Default\n         \n          Title\n        \n         \n          Date - Oldest\n        \n         \n          Date - Newest\n        \n         \n          Author\n        \n     \n  \n\n\n\n\n\n\n\n\n\n\nCausal Inference (1)\n\n\n\n\n\n\nstatistics\n\n\n\n의학 연구에서의 인과추론: 기본 개념\n\n\n\n\n\nJun 27, 2025\n\n\nHyungwoo Jo\n\n\n\n\n\n\n\n\n\n\n\n\nCompeting Risk Analysis\n\n\n\n\n\n\nstatistics\n\n\n\nCompeting Risk Analysis의 원리와 결과가 가지는 의미를 살펴봅니다\n\n\n\n\n\nJan 3, 2025\n\n\nHyungwoo Jo\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "posts/2025-06-27-causal/index.html",
    "href": "posts/2025-06-27-causal/index.html",
    "title": "Causal Inference (1)",
    "section": "",
    "text": "본 문서는 Real-World Data(RWD)를 활용한 인과추론(Causal Inference)의 핵심 개념을 다룬다. 의학 연구의 목표 중 하나는 특정 개입(intervention)이 결과(outcome)에 미치는 인과적 효과(causal effect)를 규명하는 것이다. 본 글에서는 인과추론의 근본적인 문제와, 이를 해결하기 위한 무작위 배정 임상시험(RCT), 그리고 관찰 연구(observational study)에서의 접근법을 순차적으로 소개한다."
  },
  {
    "objectID": "posts/2025-06-27-causal/index.html#서론",
    "href": "posts/2025-06-27-causal/index.html#서론",
    "title": "Causal Inference (1)",
    "section": "",
    "text": "본 문서는 Real-World Data(RWD)를 활용한 인과추론(Causal Inference)의 핵심 개념을 다룬다. 의학 연구의 목표 중 하나는 특정 개입(intervention)이 결과(outcome)에 미치는 인과적 효과(causal effect)를 규명하는 것이다. 본 글에서는 인과추론의 근본적인 문제와, 이를 해결하기 위한 무작위 배정 임상시험(RCT), 그리고 관찰 연구(observational study)에서의 접근법을 순차적으로 소개한다."
  },
  {
    "objectID": "posts/2025-06-27-causal/index.html#인과추론의-근본적인-문제-the-fundamental-problem-of-causal-inference",
    "href": "posts/2025-06-27-causal/index.html#인과추론의-근본적인-문제-the-fundamental-problem-of-causal-inference",
    "title": "Causal Inference (1)",
    "section": "1. 인과추론의 근본적인 문제 (The Fundamental Problem of Causal Inference)",
    "text": "1. 인과추론의 근본적인 문제 (The Fundamental Problem of Causal Inference)\n임상 현장에서는 특정 질환에 대해 여러 치료 대안이 존재할 때, 어떤 치료법이 더 나은 예후를 가져오는지 판단해야 하는 문제에 직면한다. 예를 들어, 특정 암으로 진단된 65세 남성 환자 ‘A’씨가 있고, 치료법으로 ’수술’과 ’약물치료’가 고려되고 있다고 가정해 보자. 이 연구에서 관심 있는 최종 결과는 ’1년 후 생존 여부’(생존 시 1, 사망 시 0)이다.\n인과추론의 핵심 개념인 잠재적 결과 프레임워크(Potential Outcomes Framework)는 이 상황을 다음과 같이 설명한다. A씨에게는 우리가 관찰할 수는 없지만 개념적으로 존재하는 두 가지의 잠재적 결과가 있다.\n\n\\(Y_{A}(1)\\): A씨가 ’수술’을 받았을 경우의 1년 후 생존 상태\n\\(Y_{A}(0)\\): A씨가 ’약물치료’를 받았을 경우의 1년 후 생존 상태\n\n만약 우리가 신처럼 모든 가능성을 알 수 있어, A씨가 수술을 받으면 1년 후 생존하고(\\(Y_{A}(1)=1\\)), 약물치료를 받으면 1년 후 사망한다(\\(Y_{A}(0)=0\\))는 사실을 안다고 상상해 보자. 이때 A씨 개인에 대한 수술의 인과적 효과는 \\(Y_{A}(1) - Y_{A}(0) = 1 - 0 = 1\\)로 명확하게 계산된다. 이 차이값, 즉 한 개인에 대한 잠재적 결과들의 차이가 바로 우리가 궁극적으로 알고자 하는 ‘진정한 인과적 효과(true causal effect)’이다. 이는 해당 치료가 그 개인에게 미친 순수한 영향의 크기를 의미한다.\n그러나 현실 세계에서 A씨는 두 가지 치료 중 단 하나만 받을 수 있다. 만약 그가 실제로 수술을 선택하여 1년 후 생존했다면, 우리는 \\(Y_{A}(1)=1\\)이라는 ‘사실적(factual)’ 결과만을 관찰할 수 있다. 그가 만약 약물치료를 받았더라면 어땠을지에 대한 결과, 즉 \\(Y_{A}(0)\\)의 값은 영원히 관찰 불가능한 ’반사실적 사실(Counterfactual)’로 남게 된다.\n이처럼 동일한 개인에 대해 모든 잠재적 결과를 동시에 관찰하는 것이 원천적으로 불가능하다는 점, 이것이 바로 ‘인과추론의 근본적인 문제(The Fundamental Problem of Causal Inference)’이다."
  },
  {
    "objectID": "posts/2025-06-27-causal/index.html#무작위-배정-임상시험-rct과-교환가능성",
    "href": "posts/2025-06-27-causal/index.html#무작위-배정-임상시험-rct과-교환가능성",
    "title": "Causal Inference (1)",
    "section": "2. 무작위 배정 임상시험 (RCT)과 교환가능성",
    "text": "2. 무작위 배정 임상시험 (RCT)과 교환가능성\n앞에서 살펴본 ‘A씨’ 개인에 대한 수술의 인과적 효과(\\(Y_{A}(1) - Y_{A}(0)\\))를 아는 것은 ‘인과추론의 근본적인 문제’로 인해 불가능하다. 그렇다면 연구자로서 우리는 어떤 의미 있는 질문을 던질 수 있을까? 바로 “A씨 한 명이 아니라, A씨와 유사한 특성을 가진 환자 집단 전체에서 수술은 약물치료에 비해 평균적으로 얼마나 효과적인가?”라는 질문이다. 이처럼 목표를 개인에서 집단으로 수정하여, 특정 인구 집단 전체에 대한 ’평균 인과 효과(Average Causal Effect, ACE 또는 Average Treatment Effect, ATE)를 추정하는 것으로 전환한다.\n이 개념을 이해하기 위해, 해당 질환을 가진 환자가 10명(A부터 J까지)뿐인 가상의 인구 집단을 상상해 보자. 신의 관점에서 이들 각각의 잠재적 결과를 모두 알고 있다고 가정하면 아래 표와 같다. (생존=1, 사망=0)\n\n\n\n\n\n\n\n\n\n환자\n수술 시 생존 여부 \\(Y(1)\\)\n약물치료 시 생존 여부 \\(Y(0)\\)\n개인의 인과 효과 \\(Y(1) - Y(0)\\)\n\n\n\n\nA\n1\n0\n1\n\n\nB\n1\n1\n0\n\n\nC\n0\n0\n0\n\n\nD\n1\n0\n1\n\n\nE\n1\n0\n1\n\n\nF\n1\n1\n0\n\n\nG\n0\n1\n-1\n\n\nH\n1\n0\n1\n\n\nI\n0\n0\n0\n\n\nJ\n1\n0\n1\n\n\n\n위 표에서 각 개인에 대한 치료의 인과 효과는 이질적(heterogeneous)이다. A, D, E, H, J 환자에게 수술은 생존을 결정짓는 긍정적 효과(+1)를 가진다. B와 F 환자에게는 두 치료법 모두 효과가 있어 차이가 없고(0), C와 I 환자에게는 두 치료법 모두 효과가 없어 역시 차이가 없다(0). 특히 G 환자의 경우, 오히려 약물치료가 더 나은 결과를 보여 수술의 효과는 부정적(-1)이다. 현실에서는 이 마지막 열, 즉 개인별 효과를 결코 알 수 없다.\n평균 인과 효과(ACE)는 바로 이 마지막 열에 있는 개인별 인과 효과들의 평균이다. \\[\\text{ACE} = \\frac{1+0+0+1+1+0+(-1)+1+0+1}{10} = \\frac{4}{10} = 0.4\\] 이 값 \\(0.4\\)는 이 인구 집단에서 약물치료 대신 수술을 선택할 경우, 생존할 확률이 평균적으로 \\(0.4\\) (또는 \\(40\\%\\)p) 증가함을 의미한다. 이는 G 환자처럼 일부에게는 수술이 해가 되더라도, 집단 전체적으로는 수술이 더 이득이 됨을 보여주는 중요한 정보다.\n이처럼 개인 수준의 효과는 알 수 없지만, 연구자들은 집단 수준의 평균적인 효과를 추정함으로써 치료법의 가치를 평가하고 임상적 의사결정에 대한 과학적 근거를 제공할 수 있다. 앞선 예시에서 우리가 신의 관점으로 계산한 ‘진정한’ 평균 인과 효과(ACE)는 \\(0.4\\)였다. 이제 현실의 연구자가 이 값을 어떻게 추정해 나가는지 살펴본다.\n\n\n무작위 배정과 평균 인과 효과 추정\n이 평균 인과 효과를 가장 신뢰도 높게 추정하기 위한 연구 설계가 바로 무작위 배정 임상시험(Randomized Controlled Trial, RCT)이다. RCT의 핵심은 무작위 배정(randomization)에 있다. 앞선 10명의 환자(A~J)를 동전 던지기와 같은 확률적 과정에 따라 5명은 수술군(Treatment, \\(T=1\\))에, 나머지 5명은 약물치료군(Control, \\(T=0\\))에 배정한다고 가정해 보자.\n무작위 배정은 매우 강력한 도구로, 각 환자가 어떤 치료를 받을지 오직 우연에 의해서만 결정되도록 한다. 만약 대상자 수가 충분히 많다면, 무작위 배정은 치료군과 대조군이 치료와 무관한 모든 특성(나이, 성별, 기저 질환의 중증도, 생활 습관 등)에서 평균적으로 거의 동일하게 분포되도록 만든다. 이는 마치 두 집단이 ‘복제된(counterfactual) 상태’와 같이 되는 것을 의미한다.\n여기서는 10명이라는 소규모 집단이지만, 무작위 배정이 성공적으로 이루어져 두 그룹의 기저 특성이 잘 균형을 이루었다고 가정해 보자. 예를 들어, 한 가지 무작위 배정 결과가 아래와 같이 나왔다고 하자.\n\n수술군 (\\(T=1\\)): {A, D, E, H, J}\n약물치료군 (\\(T=0\\)): {B, C, F, G, I}\n\n연구자는 이제 신의 관점이 아닌, 실제 관찰된 데이터만을 볼 수 있다. 즉, 수술군에 속한 환자에게서는 수술 후의 결과(\\(Y(1)\\))만을, 약물치료군에 속한 환자에게서는 약물치료 후의 결과(\\(Y(0)\\))만을 관찰하게 된다.\n\n\n\n환자\n배정된 군 (T)\n실제 관찰된 결과 (Y)\n\n\n\n\nA\n1 (수술)\n\\(Y_{A}(1)=1\\)\n\n\nB\n0 (약물)\n\\(Y_{B}(0)=1\\)\n\n\nC\n0 (약물)\n\\(Y_{C}(0)=0\\)\n\n\nD\n1 (수술)\n\\(Y_{D}(1)=1\\)\n\n\nE\n1 (수술)\n\\(Y_{E}(1)=1\\)\n\n\nF\n0 (약물)\n\\(Y_{F}(0)=1\\)\n\n\nG\n0 (약물)\n\\(Y_{G}(0)=1\\)\n\n\nH\n1 (수술)\n\\(Y_{H}(1)=1\\)\n\n\nI\n0 (약물)\n\\(Y_{I}(0)=0\\)\n\n\nJ\n1 (수술)\n\\(Y_{J}(1)=1\\)\n\n\n\n이 관찰된 데이터를 바탕으로 연구자는 각 그룹의 평균 결과를 계산한다.\n\n관찰된 수술군의 평균 생존율: \\(E[Y|T=1] = (1+1+1+1+1)/5 = 1.0\\)\n관찰된 약물치료군의 평균 생존율: \\(E[Y|T=0] = (1+0+1+1+0)/5 = 0.6\\)\n관찰된 결과의 차이: \\(1.0 - 0.6 = 0.4\\)\n\n이 값(\\(0.4\\))은 우리가 앞에서 신의 관점으로 계산했던 실제 ACE(\\(0.4\\))와 정확히 일치한다. 10명이라는 작은 표본에서도 무작위 배정이 성공적으로 이루어진다면 이렇게 실제 평균 인과 효과를 잘 추정할 수 있다. 물론 실제 임상 연구에서는 무작위 오차(Random Error)를 줄이기 위해 훨씬 더 많은 수의 환자를 대상으로 연구를 수행하며, 이러한 과정을 통해 관찰된 차이는 ‘진정한’ 평균 인과 효과에 더욱 가깝게 수렴하게 된다.\n\n\n\n교환가능성 (Exchangeability): RCT의 핵심 가정\n이것이 가능한 근본적인 원리가 바로 교환가능성(Exchangeability)이다. 무작위 배정은 두 집단의 모든 특성을 평균적으로 동일하게 만들어, 치료 개입이 시작되기 전 시점에서 두 집단을 통계적으로 거의 복제된 상태로 만든다. ’교환가능성’은 기호를 통해 더 깊이 이해할 수 있다. 무작위 배정 덕분에 우리는 치료군과 대조군의 잠재적 결과가 다음과 같은 관계를 가진다고 가정할 수 있다.\n우리가 앞서 본 10명의 환자 예시를 다시 떠올려 보자. 이 환자들을 두 그룹으로 나눌 때, 난수표를 이용해 짝수 번호가 나온 환자는 수술군에, 홀수 번호가 나온 환자는 약물치료군에 배정하는 것과 같다. 이렇게 무작위로 배정하면, 마치 신의 관점에서 보았을 때 두 그룹이 완벽하게 균형을 이루게 된다.\n예를 들어, 난수표를 통해 짝수 번호를 받아 수술군에 배정된 환자 5명(A, D, E, H, J)이 실제로 수술을 받았을 때 5명 모두 생존하여 생존율이 100%(\\(1.0\\))가 나왔다고 가정해 보자. 그리고 홀수 번호를 받아 약물치료군에 배정된 환자 5명(B, C, F, G, I)이 실제로 약물치료를 받았을 때 3명이 생존하여 생존율이 60%(\\(0.6\\))가 나왔다고 가정해 보자. 관찰된 결과의 차이는 \\(1.0 - 0.6 = 0.4\\)이다.\n여기서 핵심은 ’만약’이라는 반사실적 상황이다. 교환가능성은 다음과 같이 설명한다.\n\n수술군에 배정된 짝수 그룹(A, D, E, H, J)이 만약 약물치료를 받았다면 어땠을까(\\(E[Y(0) | T=1]\\))? 무작위 배정 덕분에, 이 짝수 그룹의 잠재적 약물치료 결과는 실제로 약물치료를 받은 홀수 그룹(B, C, F, G, I)의 결과(\\(E[Y(0) | T=0]\\))와 평균적으로 동일할 것이라고 가정할 수 있다. 즉, 짝수 그룹이 약물치료를 받았어도 홀수 그룹과 마찬가지로 5명 중 3명이 생존하여 평균 생존율이 60%(\\(0.6\\))였을 것이라는 뜻이다.\n\\(E[Y(0) | T=1] = E[Y(0) | T=0]\\)\n\n좌변 \\(E[Y(0) | T=1]\\)은 수술군(\\(T=1\\))이 만약 약물치료를 받았다면 어땠을까(\\(Y(0)\\))에 대한 평균 결과를 의미한다. 이는 수술군의 관찰 불가능한 ’반사실’이다.\n우변 \\(E[Y(0) | T=0]\\)은 실제로 약물치료군(\\(T=0\\))에서 관찰된 평균 결과이다.\n즉, ’교환가능성’이란 수술군의 반사실적 결과(만약 약물치료를 받았다면 어땠을지)가 약물치료군의 사실적 결과와 같을 것이라는 강력한 가정이며, 이는 오직 무작위 배정에 의해서만 정당화될 수 있다.\n\n\n더 나아가, 교환가능성은 치료 배정 여부(\\(T\\))와 잠재적 결과(\\(Y(1), Y(0)\\))가 서로 독립적이라는 것을 의미하며, 이를 통계적 기호로 나타내면 다음과 같다.\n\\[(Y(1), Y(0)) \\perp T\\]\n이 독립성(교환가능성) 가정 덕분에 우리는 관찰 불가능한 평균 인과 효과를 관찰 가능한 데이터로 추정할 수 있게 된다. 그 수학적 원리는 다음과 같다.\n\n우리가 추정하고자 하는 목표는 ACE = \\(E[Y(1) - Y(0)]\\) 이다.\n기댓값의 선형성에 따라, 이는 \\(E[Y(1)] - E[Y(0)]\\) 와 같다.\n무작위 배정(예: 난수표를 통한 짝수/홀수 배정)으로 인해 치료 배정 여부(\\(T\\))와 잠재적 결과(\\(Y(1), Y(0)\\))는 서로 독립적이 된다. 즉, 교환가능성이 성립한다: \\((Y(1), Y(0)) \\perp T\\)\n이 독립성(교환가능성) 가정 덕분에, 우리는 잠재적 결과의 평균을 특정 집단에서 관찰된 결과의 평균으로 대체할 수 있다.\n\n\\(E[Y(1)] = E[Y(1)|T=1] = E[Y|T=1]\\) (수술의 평균 잠재 효과는 수술군에서 관찰된 평균과 같다)\n\\(E[Y(0)] = E[Y(0)|T=0] = E[Y|T=0]\\) (약물의 평균 잠재 효과는 약물군에서 관찰된 평균과 같다)\n\n따라서, 관찰이 불가능했던 목표치 \\(E[Y(1)] - E[Y(0)]\\)는 관찰 가능한 두 집단의 평균 결과 차이, 즉 \\(E[Y|T=1] - E[Y|T=0]\\) 로 계산될 수 있다.\n\n결론적으로, RCT를 통해 계산한 치료군과 대조군의 단순한 평균 결과 차이는 ’평균 인과 효과’의 편향되지 않은(unbiased) 추정치가 된다. 이처럼 RCT는 무작위 배정이라는 강력한 장치를 통해 측정되거나 측정되지 않은 모든 교란변수 문제를 원천적으로 해결하고 인과성을 명확하게 규명해주기 때문에, 인과추론 연구의 ‘황금 표준(Gold Standard)’으로 간주된다.W"
  },
  {
    "objectID": "posts/2025-06-27-causal/index.html#관찰-연구와-조건부-교환가능성",
    "href": "posts/2025-06-27-causal/index.html#관찰-연구와-조건부-교환가능성",
    "title": "Causal Inference (1)",
    "section": "3. 관찰 연구와 조건부 교환가능성",
    "text": "3. 관찰 연구와 조건부 교환가능성\n앞서 RCT가 인과추론의 ’황금 표준’임을 확인했다. 하지만 모든 임상적 질문에 RCT를 적용하는 것은 현실적으로 불가능하거나 바람직하지 않을 때가 많다. 윤리적 문제로 인해 효과가 입증된 치료를 환자에게 제공하지 않거나, 반대로 위험할 수 있는 시술에 무작위 배정할 수 없다. 수백, 수천억에 달하는 막대한 비용과 수년에 걸친 시간은 희귀 질환이나 장기적인 효과를 연구하는 데 큰 장벽이 된다. 또한, RCT는 참여 조건이 까다로워 실제 진료 현장의 다양하고 복잡한 환자군을 대표하지 못해 결과의 일반화 가능성이 떨어지는 한계도 있다.\n이러한 이유들로 인해, 연구자들은 실제 진료 환경에서 자연스럽게 축적된 방대한 데이터, 즉 RWD(Real-World Data)를 활용한 관찰 연구에 눈을 돌리게 된다. 하지만 이와 동시에 우리는 RCT의 강력한 무기였던 ’무작위 배정’을 포기해야만 하며, 이는 선택 편향(selection bias)으로 인한 교란(confounding)이라는 새로운 문제에 직면하게 만든다.\n관찰 연구에서 치료법의 선택은 연구자의 개입 없이 환자 및 임상의의 특성에 따라 자연스럽게 결정된다. 예를 들어, 특정 질환에 대해 고령의 환자는 수술의 위험 부담으로 인해 약물치료를, 상대적으로 건강한 젊은 환자는 수술을 선택하는 경향이 있을 수 있다. 이 경우, ’수술군’은 평균 연령이 낮고, ’약물치료군’은 평균 연령이 높은 두 집단이 만들어진다.\n여기서 ’나이’는 치료법 선택(고령일수록 약물치료 선호)과 결과(고령일수록 사망 위험 높음) 모두에 영향을 미치므로 교란변수(confounder)로 작용한다. 만약 두 그룹의 사망률을 단순 비교한다면, 약물치료 그룹의 사망률이 더 높게 나타날 것이다. 하지만 이 결과는 약물치료가 덜 효과적이라서가 아니라, 단지 약물치료 그룹에 나이가 많아 사망 위험이 원래 높았던 환자들이 몰려있기 때문에 발생하는 편향일 수 있다. 즉, 치료법의 효과와 나이의 효과가 뒤섞여 나타나는 것이다.\nRCT와 달리 관찰 연구에서는 치료군과 대조군이 비교 가능하지 않은, 즉 교환가능하지 않은(non-exchangeable) 상태에서 출발한다. 이처럼 ’나이’라는 교란변수 때문에 발생하는 편향을 극복하고 공정한 비교를 하기 위해, 우리는 조건부 교환가능성(Conditional Exchangeability)이라는 핵심적인 가정을 만족시켜야 한다.\n조건부 교환가능성이란, ‘비교를 왜곡하는 교란변수(X)의 값을 동일하게 고정하고 그 조건 안을 들여다보면, 두 그룹이 비로소 공정하게 비교 가능해진다’는 핵심 아이디어이다.\n가장 직관적인 예시는 ‘나이’를 기준으로 생각해보는 것이다. 전체 환자를 비교하는 대신, 오직 75세 환자들만을 모아 그 안에서 수술받은 사람과 약물치료받은 사람의 결과를 비교한다면, 적어도 ’나이’로 인한 편향은 사라진다. 이 ’나이(\\(X\\))를 75세로 고정하는(\\(\\mid X=75\\))’ 조건 하에서는 치료 선택(\\(T\\))이 환자의 잠재적 결과(\\(Y(0), Y(1)\\))와 무관해질 것이라고 가정하는 것이 바로 조건부 교환가능성이다.\n이 개념은 아래의 통계 기호로 명확하게 표현된다.\n\\[(Y(0), Y(1)) \\perp T \\mid X\\]\n이는 ’교란변수 \\(X\\)(예: 나이)의 값을 고정하면, 잠재적 결과는 실제 받은 치료와 독립적이다’라는 우리가 통계적으로 달성하고자 하는 이상적인 상태를 의미한다.\n그렇다면 이 이상적인 상태를 현실의 데이터로 어떻게 구현할 수 있을까? 바로 이 질문에 답하기 위해, ’나이’의 효과를 통제하는 다양한 통계적 방법론들이 고안되었다.\n\n층화 분석 (Stratification): 가장 개념적으로 명확한 방법이다. 데이터를 ‘60-65세’, ‘66-70세’, ‘71-75세’ 등 여러 나이대 그룹(strata)으로 나눈다. 그리고 각 나이대 그룹 안에서만 치료 효과를 각각 계산한 뒤, 이 결과들을 종합하여 나이의 영향을 보정한 전체 평균 치료 효과를 구한다.\n회귀 모형 (Regression): 가장 널리 쓰이는 방법이다. 결과 ~ 치료법 + 나이 와 같은 회귀 모델을 사용하면, 모델이 수학적으로 ’나이’가 결과에 미치는 영향을 분리하여 계산해준다. 따라서 우리가 얻는 치료법의 효과는 이미 ‘나이가 동일하다는 조건 하에서의’ 순수한 효과가 된다.\n매칭 (Matching): 가장 직관적인 방법 중 하나다. 예를 들어, 72세인 수술 환자 한 명을 찾고, 데이터 안에서 똑같이 72세인 약물치료 환자를 찾아 1대1로 짝을 지어준다. 이 과정을 반복하여 나이가 똑같은 환자들로만 구성된 새로운 데이터셋을 만들어 비교한다. 교란변수가 많아지면 모든 변수가 똑같은 짝을 찾기 어려워지므로, 이를 요약한 성향점수(Propensity Score)를 기준으로 매칭하는 더 정교한 방법이 사용된다.\n\n이처럼 층화, 회귀, 매칭 등 각 방법의 구체적인 기술은 다르지만, 이들 모두는 ‘나이’(\\(X\\))라는 교란변수의 영향을 어떻게든 통제하여 조건부 교환가능성이라는 단 하나의 대원칙을 만족시키려는 동일한 목표를 가진 도구들이다.\n\nR 예제 코드: 교란 효과 시뮬레이션\n\nlibrary(tidyverse)\nlibrary(data.table)\nset.seed(2025)\nn &lt;- 10000\nage &lt;- runif(n, 40, 80)\nprob_med &lt;- 1 / (1 + exp(-(0.1 * (age - 60))))\ntreatment &lt;- rbinom(n, 1, prob_med)\ntreatment_fct &lt;- factor(treatment, levels = c(0, 1), labels = c(\"Surgery\", \"Medication\"))\nprob_death &lt;- 1 / (1 + exp(-(-6 + 0.08 * age)))\noutcome_death &lt;- rbinom(n, 1, prob_death)\ndf &lt;- data.table(\n  age = age,\n  treatment = treatment_fct,\n  death = outcome_death\n)\n\ncat(\"--- Descriptive Statistics by Group ---\\n\")\n\n--- Descriptive Statistics by Group ---\n\ndf %&gt;% \n  group_by(treatment) %&gt;% \n  summarise(\n    N = n(),\n    mean_age = mean(age),\n    death_rate = mean(death)\n  ) \n\n# A tibble: 2 × 4\n  treatment      N mean_age death_rate\n  &lt;fct&gt;      &lt;int&gt;    &lt;dbl&gt;      &lt;dbl&gt;\n1 Surgery     4977     54.4      0.192\n2 Medication  5023     65.5      0.347\n\nmodel_crude &lt;- glm(death ~ treatment, data = df, family = \"binomial\")\ncrude_or &lt;- exp(coef(model_crude)[\"treatmentMedication\"])\ncrude_ci &lt;- exp(confint(model_crude)[\"treatmentMedication\", ])\n\nmodel_adjusted &lt;- glm(death ~ treatment + age, data = df, family = \"binomial\")\nadjusted_or &lt;- exp(coef(model_adjusted)[\"treatmentMedication\"])\nadjusted_ci &lt;- exp(confint(model_adjusted)[\"treatmentMedication\", ])\n\ncat(\"\\n--- Comparison of Odds Ratios (with 95% CI) ---\\n\")\n\n\n--- Comparison of Odds Ratios (with 95% CI) ---\n\ncat(paste0(\"Crude Odds Ratio: \", round(crude_or, 2), \n           \" (95% CI: \", round(crude_ci[1], 2), \" - \", round(crude_ci[2], 2), \")\\n\"))\n\nCrude Odds Ratio: 2.24 (95% CI: 2.04 - 2.45)\n\ncat(paste0(\"Age-Adjusted Odds Ratio: \", round(adjusted_or, 2), \n           \" (95% CI: \", round(adjusted_ci[1], 2), \" - \", round(adjusted_ci[2], 2), \")\\n\"))\n\nAge-Adjusted Odds Ratio: 1.05 (95% CI: 0.95 - 1.17)\n\n\n시뮬레이션 데이터의 그룹별 특성을 먼저 살펴보면, 약물치료 그룹의 평균 연령(약 65세)이 수술 그룹(약 55세)보다 약 10세 더 높고, 그에 따라 사망률 역시 현저히 높은 것을 확인할 수 있다. 이 데이터만으로 로지스틱 회귀 분석을 수행했을 때, 수술 대비 약물치료의 오즈비는 2.24로 높게 나타난다는 것을 알 수 있다. 95% 신뢰구간이 1을 훌쩍 넘어서므로, 이 결과만 보면 약물치료가 통계적으로 유의하게 사망 위험을 2배 이상 높이는 것처럼 해석된다. 하지만 이것은 ‘나이’라는 교란변수가 만들어낸 결과라는 것을 알 수 있다. 모델에 ’나이’ 변수를 추가하여 그 효과를 통계적으로 보정한 결과, 나이-보정 오즈비(Age-Adjusted Odds Ratio)는 1.05 (95% 신뢰구간: 0.95 - 1.17)로 극적으로 감소한다. 이는 통계적으로 두 치료법 간에 유의미한 사망 위험 차이가 없다는 뜻이며, ’두 치료법의 실제 효과는 동일하다’는 우리가 시뮬레이션에 설정한 진실을 정확하게 반영한다. 이처럼 교란변수 보정은 잘못된 결론을 바로잡고, 신뢰구간과 함께 결과의 불확실성을 평가함으로써 우리가 더 진실에 가까운 인과적 추론을 하도록 돕는다는 것을 알 수 있다."
  },
  {
    "objectID": "posts/2025-06-27-causal/index.html#미측정-교란변수의-한계",
    "href": "posts/2025-06-27-causal/index.html#미측정-교란변수의-한계",
    "title": "Causal Inference (1)",
    "section": "4. 미측정 교란변수의 한계",
    "text": "4. 미측정 교란변수의 한계\n’나이’처럼 우리가 측정할 수 있는 교란변수 X를 모두 통계적으로 보정했다 하더라도, 관찰 연구의 문제는 끝나지 않는다. 바로 미측정 교란변수(unmeasured confounders)의 존재 가능성이다.\n예를 들어, 환자의 ‘가정 환경 및 사회경제적 수준(SES)’이라는 변수가 있다고 가정해보자. 이 변수는 보통 병원의 데이터베이스에는 기록되지 않아 측정하기 어렵다. 하지만 SES는 다음과 같이 치료 선택과 결과 모두에 영향을 미칠 수 있다.\nSES와 치료 선택: 경제적으로 어려운 환자는 수술 후 회복 기간 동안 일을 쉬기 어려워, 회복이 빠른 약물치료를 선호할 수 있다.\nSES와 결과: 낮은 SES는 평소 영양 상태나 건강 정보에 대한 접근성이 낮아 기저 건강 상태가 좋지 않을 수 있으며, 이는 치료법과 무관하게 사망 위험을 높일 수 있다.\n이 경우 SES는 ’나이’와 마찬가지로 교란변수 역할을 하지만, 데이터에 없기 때문에 우리는 ’SES가 낮은 그룹’으로 조건을 걸어 비교하는 것이 불가능하다. 결국 SES로 인한 편향이 제거되지 않은 채 결과에 반영되고, 연구자는 SES의 효과를 약물치료의 효과로 잘못 해석할 위험에 처한다.\n\nlibrary(tidyverse)\nlibrary(data.table)\nn &lt;- 10000 \nage &lt;- runif(n, 40, 80)\n\nses &lt;- rbinom(n, 1, 0.5)\n\nprob_med &lt;- 1 / (1 + exp(-(0.1 * (age - 60) -  ses)))\ntreatment &lt;- rbinom(n, 1, prob_med)\ntreatment_fct &lt;- factor(treatment, levels = c(0, 1), labels = c(\"Surgery\", \"Medication\"))\n\nprob_death &lt;- 1 / (1 + exp(-(-6 + 0.08 * age - 0.7 * ses)))\noutcome_death &lt;- rbinom(n, 1, prob_death)\n\ndf &lt;- data.table(\n  age = age,\n  ses = ses, \n  treatment = treatment_fct,\n  death = outcome_death\n)\n\nmodel_crude &lt;- glm(death ~ treatment, data = df, family = \"binomial\")\ncrude_or &lt;- exp(coef(model_crude)[\"treatmentMedication\"])\ncrude_ci &lt;- exp(confint(model_crude)[\"treatmentMedication\", ])\n\nmodel_adjusted_age_only &lt;- glm(death ~ treatment + age, data = df, family = \"binomial\")\nadjusted_or_age_only &lt;- exp(coef(model_adjusted_age_only)[\"treatmentMedication\"])\nadjusted_ci_age_only &lt;- exp(confint(model_adjusted_age_only)[\"treatmentMedication\", ])\n\nmodel_fully_adjusted &lt;- glm(death ~ treatment + age + ses, data = df, family = \"binomial\")\nfully_adjusted_or &lt;- exp(coef(model_fully_adjusted)[\"treatmentMedication\"])\nfully_adjusted_ci &lt;- exp(confint(model_fully_adjusted)[\"treatmentMedication\", ])\n\n\ncat(\"--- Comparison of Odds Ratios (with Unmeasured Confounding) ---\\n\")\n\n--- Comparison of Odds Ratios (with Unmeasured Confounding) ---\n\ncat(paste0(\"1. Crude Odds Ratio: \", round(crude_or, 2), \n           \" (95% CI: \", round(crude_ci[1], 2), \" - \", round(crude_ci[2], 2), \")\\n\"))\n\n1. Crude Odds Ratio: 2.31 (95% CI: 2.09 - 2.55)\n\ncat(paste0(\"2. Age-Adjusted Odds Ratio (Researcher's View): \", round(adjusted_or_age_only, 2), \n           \" (95% CI: \", round(adjusted_ci_age_only[1], 2), \" - \", round(adjusted_ci_age_only[2], 2), \")\\n\"))\n\n2. Age-Adjusted Odds Ratio (Researcher's View): 1.13 (95% CI: 1.01 - 1.26)\n\ncat(paste0(\"3. Fully Adjusted Odds Ratio (God's View): \", round(fully_adjusted_or, 2), \n           \" (95% CI: \", round(fully_adjusted_ci[1], 2), \" - \", round(fully_adjusted_ci[2], 2), \")\\n\"))\n\n3. Fully Adjusted Odds Ratio (God's View): 0.96 (95% CI: 0.85 - 1.08)\n\n\n이번 시뮬레이션에서는 우리가 측정할 수 없는 교란변수 ’SES’가 존재할 때 어떤 일이 발생하는지 보여준다. 이 데이터는 ’낮은 SES’가 약물치료 선택 확률과 사망 확률을 모두 높이도록, 하지만 치료법 자체의 실제 효과는 없도록(True OR = 1.0) 설계되었다.시뮬레이션 결과에서 살펴볼수 있듯이, ses라는 변수를 우리가 모르는 경우에 나이라는 알고 있는 변수를 보정하더라도 오즈비를 1.18로 해석하여 위험비를 실제 값인 1과 다르게 해석하여 통계적으로 유의미하게 잘못된 결론을 내리게 된다는 것을 알 수 있다. 따라서 우리가 아는 교란변수를 정교하게 보정하더라도, 데이터에 없는 중요한 교란변수가 있는 경우 추정치가 진실에서 벗어난 편향된 값을 갖게 된다는 것을 알 수 있다.\n이것이 관찰 연구의 근본적인 한계이며, RCT가 Gold Standard인 이유이다. RCT에서는 무작위 배정을 통해 부유한 사람이든, 어려운 환경의 사람이든 모두가 수술군과 약물군에 확률적으로 고르게 분포하게 된다. 따라서 RCT는 우리가 사전에 인지하고 측정한 변수뿐만 아니라, 인지하지 못했거나 측정하지 못한 미지의 교란변수(SES, 유전적 특성, 성격 등)까지도 통계적으로 통제해준다. 하지만 RWD를 활용하는 관찰 연구에서는 이러한 완벽한 보장을 할 수 없으므로, 알려진 교란변수를 최대한 보정하여 최선의 추정치를 찾아내고자 노력하는 것이다. 5. 결론: 이상, 현실, 그리고 나아갈 길 본 글에서는 의학 연구에서 ’어떤 치료법이 더 나은가’라는 질문에 답하기 위한 인과추론의 여정을 살펴보았다. 우리는 한 개인에게 두 가지 치료법의 결과를 동시에 관찰할 수 없다는 ‘인과추론의 근본적인 문제’에서 출발했다. 이로 인해 한 개인에 대한 진정한 인과적 효과(Y(1)−Y(0))는 이상적인 개념으로만 남을 뿐, 직접 계산하는 것은 불가능하다.\n이러한 한계에 직면하여, 연구자들은 실용적인 대안으로 목표를 전환한다. 바로 개인의 효과가 아닌, 집단 전체에 대한 ‘평균 인과 효과(ATE)’를 추정하는 것이다. 이는 특정 치료법이 인구 집단에 평균적으로 미치는 영향을 평가하는 강력하고 유용한 지표가 되며, 임상 현장과 보건 정책 수립에 중요한 과학적 근거를 제공한다.\n이 ATE를 추정하는 가장 신뢰도 높은 Gold Standard는 RCT이다. RCT는 무작위 배정이라는 강력한 장치를 통해 측정 가능 여부와 상관없이 모든 교란변수의 영향을 원천적으로 차단한다. 그 결과, 치료군과 대조군은 완벽히 교환가능해지며, 두 집단의 단순 결과 비교만으로도 ATE의 불편향 추정치를 얻을 수 있다.\n하지만 현실적인 제약으로 RCT 수행이 어려울 때, 우리는 차선책으로 RWD를 활용한 관찰 연구에 의존하게 된다. 관찰 연구에서는 무작위 배정이 없으므로, 연구자가 직접 교란변수 문제를 해결해야 한다. 우리는 ‘나이’와 같이 알려진 교란변수(X)를 통계적으로 보정함으로써, X의 특정 값 안에서는 두 집단이 교환 가능하다는 ’조건부 교환가능성’ 가정을 만족시키고자 노력한다.\n그러나 이 접근법은 우리가 측정하지 못했거나, 존재 자체를 모르는 ‘미측정 교란변수’ 앞에서는 한계를 가진다. 관찰 연구의 신뢰성은 ’중요한 미측정 교란변수가 없다’는 강력하고 증명 불가능한 가정에 의존하게 되는 것이다. 결론적으로, RWD를 이용한 인과추론은 불완전한 데이터 속에서 RCT의 이상적인 상황을 최대한 흉내 내어, 여러 편향들을 제거하고 참값에 근접해가는 과정이라 할 수 있다."
  },
  {
    "objectID": "posts/2025-06-27-causal/index.html#또-다른-도전-시간축의-함정-time-related-biases",
    "href": "posts/2025-06-27-causal/index.html#또-다른-도전-시간축의-함정-time-related-biases",
    "title": "Causal Inference (1)",
    "section": "5. 또 다른 도전: 시간축의 함정 (Time-related Biases)",
    "text": "5. 또 다른 도전: 시간축의 함정 (Time-related Biases)\n지금까지 우리는 ’누구를 비교할 것인가’에 대한 문제, 즉 교란(Confounding)에 대해 집중적으로 살펴보았다. 이는 RWD 인과추론의 가장 중요하고 핵심적인 도전이다. 하지만 RWD 연구의 복잡성은 여기서 그치지 않는다. 교란만큼이나 치명적일 수 있는 두 번째 도전 과제가 남아있기 때문이다. 바로 “언제부터를 연구의 시작점(Time-zero)으로 볼 것인가?” 라는 시간축 설정의 문제이다.\nRCT에서는 모든 것이 명확하다. 환자가 연구에 동의하고 무작위 배정되는 그 순간이 모든 추적 관찰의 시작점(Time-zero)이 된다. 환자 등록(Eligibility, E), 연구 시작(Time-zero, T0), 치료 배정(Assignment, A)이 한 지점에서 동시에 일어난다. 하지만 RWD에서는 이 세 가지 시점이 각기 다르게 흩어져 있는 경우가 대부분이며, 이를 잘못 정렬할 경우 연구 결과가 완전히 왜곡될 수 있다. 실제 유명 연구 사례와 간단한 시뮬레이션을 통해 그 위험성을 살펴보자.\n5.1 사례: 불멸 시간 편향 (Immortal Time Bias)과 호르몬 대체 요법(HRT) 과거 여러 관찰 연구에서는 폐경 후 여성을 대상으로 한 호르몬 대체 요법(HRT)이 심혈관 질환 위험을 크게 낮춘다(RR 0.61)고 보고했다. 하지만 이후 진행된 대규모 RCT(WHI Trial)에서는 정반대로 HRT가 오히려 위험을 약간 높인다(HR 1.23)는 충격적인 결과가 나왔다. 이 차이는 어디서 발생했을까?\n바로 ‘불멸의 시간(Immortal Time)’ 때문이다. 관찰 연구에서 ’HRT 사용자’로 분류되려면, 한 여성은 폐경을 겪고, 상당 기간 생존해 있다가, 어느 날 HRT를 처방받기로 결정하고, 실제로 처방받는 그날까지 반드시 생존해 있어야만 한다. 이 ’처방 전까지 생존이 보장된 시간’이 바로 불멸의 시간이다. 이 기간 동안에는 약물 사용군으로 분류될 환자가 사망하는 사건이 원천적으로 불가능하다. 이 기간을 부적절하게 분석에 포함하면, HRT 사용군의 생존율이 인위적으로 부풀려져 약물의 효과가 실제보다 훨씬 더 좋은 것처럼 보이는 치명적인 착시가 발생한다.\nR 시뮬레이션: 불멸 시간 편향의 재현 HRT의 실제 효과가 전혀 없다고(True HR = 1.0) 가정하고, 단지 치료 시작 시점만 환자마다 다른 상황을 시뮬레이션해보자.\n\nlibrary(tidyverse)\nlibrary(survival)\nlibrary(jstable)\nset.seed(2025)\nn &lt;- 10000\n\ntrue_death_time &lt;- rexp(n, rate = 0.3)\ntime_to_tx &lt;- runif(n, 0, 5)\ntime_to_tx[sample(n, n/2)] &lt;- NA \ndf &lt;- tibble(\n  id = 1:n,\n  death_time = true_death_time,\n  tx_start_time = time_to_tx,\n  event = 1 \n)\ndf_biased &lt;- df %&gt;%\n  filter(!(!is.na(tx_start_time) & death_time &lt; tx_start_time)) %&gt;%\n  mutate(\n    group = ifelse(is.na(tx_start_time), \"Never Treated\", \"Ever Treated\")\n  )\nbiased_model &lt;- coxph(Surv(death_time, event) ~ group, data = df_biased, model = T)\ncat(\"--- Biased Analysis with Immortal Time ---\\n\")\n\n--- Biased Analysis with Immortal Time ---\n\ncox2.display(biased_model)\n\n$table\n                   HR(95%CI)          P value  \ngroupNever Treated \"1.67 (1.59,1.75)\" \"&lt; 0.001\"\n\n$metric\n                        [,1] [,2]\n&lt;NA&gt;                      NA   NA\nNo. of observations   7613.0   NA\nNo. of events         7613.0   NA\nAIC                 120409.6   NA\n\n$caption\n[1] \"Cox model on time ('death_time') to event ('event')\"\n\n\n코드 해석: 위 시뮬레이션에서는 치료(HRT)가 생존에 아무런 영향을 주지 않도록 설계했다. 하지만 ‘치료 여부’를 단순히 ’받은 적 있음/없음’으로 나누어 분석한 결과, ’Ever Treated’ 그룹의 Hazard Ratio(exp(coef))는 약 0.73으로 나타난다. 이는 치료를 받은 그룹의 사망 위험이 27%나 낮은 것처럼 보이는 심각한 편향이다. 이는 순전히 ‘Ever Treated’ 그룹의 환자들이 치료를 받기 전까지 생존했던 ‘불멸의 시간’ 때문에 발생한 착시 현상이다.\n5.2 사례: 기존 사용자 편향 (Prevalent User Bias)과 스타틴(Statin) 스타틴의 심혈관 질환 예방 효과를 다룬 한 유명 관찰 연구에서는 스타틴이 사망 위험을 유의미하게 낮춘다(HR 0.85)고 보고했지만, 이 역시 여러 RCT의 메타분석 결과(HR 1.00)와는 상반된 결과였다.\n이 편향의 원인은 ‘기존 사용자(Prevalent User)’를 연구에 포함했기 때문이다. 연구 시작 시점에 이미 스타틴을 오랫동안 복용해 온 환자들은 약물의 초기 부작용이나 안 좋은 효과를 이미 ‘통과하고 살아남은’ 건강한 환자들일 가능성이 높다. 약물에 잘 적응하지 못했거나 초기에 부작용을 겪은 환자들은 이미 복용을 중단했을 것이다. 이처럼 ‘선택된 생존자’ 그룹을 약물을 처음 사용하는 그룹(New User)과 비교하면, 약물의 안전성이나 효과가 실제보다 과대평가될 수밖에 없다.\nR 시뮬레이션: 기존 사용자 편향의 재현 스타틴에 ‘민감한(susceptible)’ 환자 그룹과 ‘강건한(robust)’ 환자 그룹이 있다고 가정하고, 민감한 그룹은 초기에 탈락할 확률이 높다고 시뮬레이션해보자.\n\nset.seed(2025)\nn &lt;- 10000\n\nsusceptible &lt;- rbinom(n, 1, 0.2)\n\nprob_dropout &lt;- ifelse(susceptible == 1, 0.5, 0.05)\nwashin_survivor &lt;- rbinom(n, 1, 1 - prob_dropout)\n\ndf_prevalent &lt;- tibble(id = 1:n, susceptible = susceptible) |&gt;\n  filter(washin_survivor == 1)\n\ndf_new &lt;- tibble(id = (n+1):(2*n), susceptible = rbinom(n, 1, 0.2))\n\n\nprob_death_future &lt;- ifelse(df_prevalent$susceptible == 1, 0.2, 0.05)\nprevalent_death_rate &lt;- mean(rbinom(nrow(df_prevalent), 1, prob_death_future))\n\nprob_death_future_new &lt;- ifelse(df_new$susceptible == 1, 0.2, 0.05)\nnew_user_death_rate &lt;- mean(rbinom(nrow(df_new), 1, prob_death_future_new))\n\ncat(\"\\n--- Bias from Prevalent Users ---\\n\")\n\n\n--- Bias from Prevalent Users ---\n\ncat(paste(\"Death Rate among Prevalent Users:\", round(prevalent_death_rate, 3), \"\\n\"))\n\nDeath Rate among Prevalent Users: 0.066 \n\ncat(paste(\"Death Rate among New Users:\", round(new_user_death_rate, 3), \"\\n\"))\n\nDeath Rate among New Users: 0.083 \n\n\n코드 해석: 시뮬레이션 결과, 기존 사용자 그룹의 사망률(약 5.9%)이 신규 사용자 그룹의 사망률(약 7.8%)보다 현저히 낮게 나타난다. 이는 약물이 장기적으로 더 효과적이어서가 아니라, 기존 사용자 그룹에는 약물에 취약했던 ‘민감한’ 환자들이 초기에 이미 걸러졌기 때문이다. 이처럼 약물 사용 경험이 다른 두 그룹을 직접 비교하면, 우리는 약물의 효과를 심각하게 오인할 수 있다.\n결론: 두 가지 도전을 넘어 결론적으로, RWD를 이용한 인과추론은 ’사과와 오렌지를 비교’하는 교란(Confounding)의 문제와, ’출발선이 다른 달리기 경주’를 보는 듯한 시간축 설정(Time-related biases)의 문제라는 두 가지 큰 도전에 직면한다.\n지금까지 우리는 이 두 가지 도전이 왜 발생하며 연구 결과를 얼마나 심각하게 왜곡할 수 있는지 실제 사례와 코드를 통해 살펴보았다. 다음 파트부터는 이 두 가지 도전을 하나씩 정복해 나갈 것이다.\n먼저 Part 2에서는 ‘교란’ 문제를 해결하기 위한 다양한 통계 및 머신러닝 기법들을 심도 있게 다룰 것이다. 그리고 Part 3에서는 오늘 소개한 ’시간의 함정’들을 피하기 위한 연구 설계와 표적 시험 모방(Target Trial Emulation)과 같은 고급 분석 전략에 대해 알아볼 예정이다. 이 여정을 통해 우리는 불완전한 데이터 속에서 어떻게 더 신뢰도 높은 인과적 추론을 할 수 있는지에 대한 통찰을 얻게 될 것이다."
  },
  {
    "objectID": "posts/2025-06-27-causal/index.html#시간축관련-편향-time-related-biases",
    "href": "posts/2025-06-27-causal/index.html#시간축관련-편향-time-related-biases",
    "title": "Causal Inference (1)",
    "section": "5. 시간축관련 편향 (Time-related Biases)",
    "text": "5. 시간축관련 편향 (Time-related Biases)\n지금까지 우리는 ’누구를 비교할 것인가’에 대한 문제, 즉 교란(Confounding)에 대해 집중적으로 살펴보았다. 이는 RWD 인과추론의 가장 중요하고 핵심적인 도전이다. 하지만 RWD 연구의 복잡성은 여기서 그치지 않는다. 교란만큼이나 치명적일 수 있는 두 번째 도전 과제가 남아있기 때문이다. 바로 “언제부터를 연구의 시작점(Time-zero)으로 볼 것인가?” 라는 시간축 설정의 문제이다.\nRCT에서는 모든 것이 명확하다. 환자가 연구에 동의하고 무작위 배정되는 그 순간이 모든 추적 관찰의 시작점(Time-zero)이 된다. 환자 등록(Eligibility, E), 연구 시작(Time-zero, T0), 치료 배정(Assignment, A)이 한 지점에서 동시에 일어난다. 하지만 RWD에서는 이 세 가지 시점이 각기 다르게 흩어져 있는 경우가 대부분이며, 이를 잘못 정렬할 경우 연구 결과가 완전히 왜곡될 수 있다. 실제 유명 연구 사례와 간단한 시뮬레이션을 통해 그 위험성을 살펴보자.\n5.1 사례: 불멸 시간 편향 (Immortal Time Bias)과 호르몬 대체 요법(HRT) 과거 여러 관찰 연구에서는 폐경 후 여성을 대상으로 한 호르몬 대체 요법(HRT)이 심혈관 질환 위험을 크게 낮춘다(RR ≈ 0.6)고 보고했다. 하지만 이후 진행된 대규모 RCT(WHI Trial)에서는 정반대로 HRT가 오히려 위험을 약간 높인다(HR ≈ 1.2)는 결과가 나왔다. 이 극적인 차이는 어디서 발생한 것인가?\n많은 전문가는 그 원인으로 불멸 시간 편향(Immortal Time Bias)을 지목한다. 이는 단순히 시간을 잘못 계산하는 문제를 넘어, 연구 설계상 치료군(HRT 사용자)에 상대적으로 더 건강한 사람들이 선택될 수밖에 없는 구조적인 선택 편향을 유발하기 때문이다.\n이 편향이 발생하는 과정을 살펴보면 다음과 같다. 관찰 연구에서 한 여성이 ’HRT 사용자’로 분류되려면, ①폐경을 겪고, ②상당 기간 생존하다가, ③어느 날 HRT를 처방받기로 결정하고, ④실제로 처방받는 그날까지 반드시 심혈관 질환 없이 생존해 있어야만 한다.\n여기서 ‘폐경 후부터 HRT를 처방받기 전까지의 시간’, 즉 ‘치료를 받기 위해 반드시 생존해야만 했던 대기 시간’이 바로 불멸의 시간(Immortal Time)이다. 이 기간 동안 심혈관 질환으로 사망했다면, 그 환자는 ‘HRT 사용자’ 그룹에 절대 포함될 수 없다.\n결과적으로 ‘HRT 사용자’ 그룹은 이 ‘불멸의 시간’이라는 생존 테스트를 통과한, 즉 처방 시점까지 상대적으로 건강했던 사람들만으로 구성되는 심각한 문제가 발생한다. 반면 ’비사용자’ 그룹에는 이 테스트를 통과하지 못한, 즉 조기에 사망한 건강하지 않은 환자들까지 포함된다.\n결국, 두 집단은 연구 시작 시점부터 이미 ’건강 상태’라는 중요한 교란변수에 대해 공정하게 비교할 수 없는 상태가 된다. 분석가는 이 ’건강한 사람들의 생존 우위’를 HRT 약물의 효과로 착각하게 되고, 약물이 실제보다 훨씬 더 좋은 것처럼 보이는 잘못된 결론을 내리게 되는 것이다.\nR 시뮬레이션: 불멸 시간 편향의 재현 HRT의 실제 효과가 전혀 없다고(True HR = 1.0) 가정하고, 단지 치료 시작 시점만 환자마다 다른 상황을 시뮬레이션한다. 분석 과정에서 ’치료 시작 전에 사망한 환자’를 제외하는, 실제 연구에서 발생했던 오류를 그대로 재현해 본다.\n\nlibrary(tidyverse)\nlibrary(survival)\nlibrary(jstable)\nset.seed(2025)\nn &lt;- 10000\n\ntrue_death_time &lt;- rexp(n, rate = 0.3)\ntime_to_tx &lt;- runif(n, 0, 5)\ntime_to_tx[sample(n, n/2)] &lt;- NA \ndf &lt;- tibble(\n  id = 1:n,\n  death_time = true_death_time,\n  tx_start_time = time_to_tx,\n  event = 1 \n)\n\n# Immortal Time Bias를 유발하는 분석 오류 재현\n# \"Ever Treated\" 그룹에서 치료 시작 전 사망자를 제외\ndf_biased &lt;- df %&gt;%\n  filter(!(!is.na(tx_start_time) & death_time &lt; tx_start_time)) %&gt;%\n  mutate(\n    group = ifelse(is.na(tx_start_time), \"Never Treated\", \"Ever Treated\")\n  )\n\nbiased_model &lt;- coxph(Surv(death_time, event) ~ group, data = df_biased, model = T)\ncat(\"--- Biased Analysis with Immortal Time ---\\n\")\n\n--- Biased Analysis with Immortal Time ---\n\ncox2.display(biased_model)\n\n$table\n                   HR(95%CI)          P value  \ngroupNever Treated \"1.67 (1.59,1.75)\" \"&lt; 0.001\"\n\n$metric\n                        [,1] [,2]\n&lt;NA&gt;                      NA   NA\nNo. of observations   7613.0   NA\nNo. of events         7613.0   NA\nAIC                 120409.6   NA\n\n$caption\n[1] \"Cox model on time ('death_time') to event ('event')\"\n\n\n코드 해석: 위 시뮬레이션에서는 치료(HRT)가 생존에 아무런 영향을 주지 않도록 설계했다. 하지만 filter() 구문을 통해 ‘치료를 받기 전에 사망한 환자’를 분석에서 제외하는 오류를 적용하자, ’Ever Treated’ 그룹의 Hazard Ratio(exp(coef))는 약 0.73으로 나타난다.\n이는 치료를 받은 그룹의 사망 위험이 27%나 낮은 것처럼 보이는 심각한 편향이다. 이 결과는 약물의 효과가 아니라, 단지 ‘Ever Treated’ 그룹이 치료를 받기 위해 생존해야 했던 ’불멸의 시간’이라는 관문을 통과한, 선천적으로 더 건강한 집단이었기 때문에 발생한 착시 현상이다. 이처럼 시간축을 잘못 설정하는 것은 결국 비교 집단의 근본적인 특성을 왜곡하여 인과추론을 불가능하게 만든다.\n5.2 사례: 기존 사용자 편향 (Prevalent User Bias)과 스타틴(Statin) 스타틴의 심혈관 질환 예방 효과를 다룬 한 유명 관찰 연구에서는 스타틴이 사망 위험을 유의미하게 낮춘다(HR 0.85)고 보고했지만, 이 역시 여러 RCT의 메타분석 결과(HR 1.00)와는 상반된 결과였다.\n이 편향의 원인은 ‘기존 사용자(Prevalent User)’를 연구에 포함했기 때문이다. 연구 시작 시점에 이미 스타틴을 오랫동안 복용해 온 환자들은 약물의 초기 부작용이나 안 좋은 효과를 이미 ‘통과하고 살아남은’ 건강한 환자들일 가능성이 높다. 약물에 잘 적응하지 못했거나 초기에 부작용을 겪은 환자들은 이미 복용을 중단했을 것이다. 이처럼 ‘선택된 생존자’ 그룹을 약물을 처음 사용하는 그룹(New User)과 비교하면, 약물의 안전성이나 효과가 실제보다 과대평가될 수밖에 없다.\nR 시뮬레이션: 기존 사용자 편향의 재현 스타틴에 ‘민감한(susceptible)’ 환자 그룹과 ‘강건한(robust)’ 환자 그룹이 있다고 가정하고, 민감한 그룹은 초기에 탈락할 확률이 높다고 시뮬레이션해보자.\n\nset.seed(2025)\nn &lt;- 10000\n\nsusceptible &lt;- rbinom(n, 1, 0.2)\n\nprob_dropout &lt;- ifelse(susceptible == 1, 0.5, 0.05)\nwashin_survivor &lt;- rbinom(n, 1, 1 - prob_dropout)\n\ndf_prevalent &lt;- tibble(id = 1:n, susceptible = susceptible) |&gt;\n  filter(washin_survivor == 1)\n\ndf_new &lt;- tibble(id = (n+1):(2*n), susceptible = rbinom(n, 1, 0.2))\n\n\nprob_death_future &lt;- ifelse(df_prevalent$susceptible == 1, 0.2, 0.05)\nprevalent_death_rate &lt;- mean(rbinom(nrow(df_prevalent), 1, prob_death_future))\n\nprob_death_future_new &lt;- ifelse(df_new$susceptible == 1, 0.2, 0.05)\nnew_user_death_rate &lt;- mean(rbinom(nrow(df_new), 1, prob_death_future_new))\n\ncat(\"\\n--- Bias from Prevalent Users ---\\n\")\n\n\n--- Bias from Prevalent Users ---\n\ncat(paste(\"Death Rate among Prevalent Users:\", round(prevalent_death_rate, 3), \"\\n\"))\n\nDeath Rate among Prevalent Users: 0.066 \n\ncat(paste(\"Death Rate among New Users:\", round(new_user_death_rate, 3), \"\\n\"))\n\nDeath Rate among New Users: 0.083 \n\n\n코드 해석: 시뮬레이션 결과, 기존 사용자 그룹의 사망률(약 5.9%)이 신규 사용자 그룹의 사망률(약 7.8%)보다 현저히 낮게 나타난다. 이는 약물이 장기적으로 더 효과적이어서가 아니라, 기존 사용자 그룹에는 약물에 취약했던 ‘민감한’ 환자들이 초기에 이미 걸러졌기 때문이다. 이처럼 약물 사용 경험이 다른 두 그룹을 직접 비교하면, 우리는 약물의 효과를 심각하게 오인할 수 있다.\n결론: 두 가지 도전을 넘어 결론적으로, RWD를 이용한 인과추론은 ’사과와 오렌지를 비교’하는 교란(Confounding)의 문제와, ’출발선이 다른 달리기 경주’를 보는 듯한 시간축 설정(Time-related biases)의 문제라는 두 가지 큰 도전에 직면한다.\n지금까지 우리는 이 두 가지 도전이 왜 발생하며 연구 결과를 얼마나 심각하게 왜곡할 수 있는지 실제 사례와 코드를 통해 살펴보았다. 다음 파트부터는 이 두 가지 도전을 하나씩 정복해 나갈 것이다.\n먼저 Part 2에서는 ‘교란’ 문제를 해결하기 위한 다양한 통계 및 머신러닝 기법들을 심도 있게 다룰 것이다. 그리고 Part 3에서는 오늘 소개한 ’시간의 함정’들을 피하기 위한 연구 설계와 표적 시험 모방(Target Trial Emulation)과 같은 고급 분석 전략에 대해 알아볼 예정이다. 이 여정을 통해 우리는 불완전한 데이터 속에서 어떻게 더 신뢰도 높은 인과적 추론을 할 수 있는지에 대한 통찰을 얻게 될 것이다."
  }
]