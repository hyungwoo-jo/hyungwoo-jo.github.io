---
title: "Competing Risk Analysis"
description: "Fine-Gray Method 공부 내용 정리"
image: img/image.png
categories: [statistics]
author:
  - name: Hyungwoo Jo
    url: https://github.com/sl-eeper
fig_width: 400
date: 2025-01-03
format: html
execute:
  freeze: true
draft: false
citation: true
---

# Competing Risk

경쟁 위험(Competing risk)은 한 종류의 이벤트가 발생하면 다른 이벤트가 발생할 수 없는 상황으로 정의됩니다다. 예를 들어, 암 재발이 event of interest 인 경우 사망이 competing risk로 작용할 수 있습니다 (사망한 암 환자에게는 암 재발이라는 event가 발생 할 수 없기 때문). 경쟁 위험을 무시하면 **모집단의 생존 함수**나 **이벤트 발생률**을 **과대 혹은 과소평가** 할 위험이 생기기에 이를 고려한 분석이 필요한 경우들이 있습니다. 예를 들어 고령에 암을 진단 받은 환자의 경우 사망이 competing risk로 강하게 작용하여 이를 다 censoring이 되었다고 고려할시 이벤트 발생률이 왜곡될 수 있기 때문입니다. 이를 고려한 분석에 대해 알아보기 위해 기초적인 생존 분석의 개념을 간략하게 살펴보고 넘어가겠습니다.

## 생존 함수

$$
S(t) = \prod_{i: t_i \leq t} \left(1 - \frac{d_i}{n_i}\right)
$$

-   S(t): 생존 함수\

-   $t_i$: 사건 발생 시점\

-   $d_i$: 시점 $t_i$에서 발생한 사건 수\

-   $n_i$: 시점 $t_i$에서 위험에 노출된 대상 수\

-   결국 **생존 함수란 각 사건 발생 시점에서의 생존 확률(어떤 이벤트도 발생하지 않을 확률)을 누적 곱하여 계산한 시간 $t$까지 생존할 확률**을 뜻합니다.

## 위험 함수

$$
  \lambda_k(t) = \lim_{\Delta t \to 0} \frac{P(t \leq T < t + \Delta t, \epsilon = k \mid T \geq t)}{\Delta t}
  $$

-   $\lambda_k(t)$: 이벤트 유형 $k$의 원인별 위험 함수\

-   T: 이벤트 발생 시간\

-   $\epsilon$: 이벤트 유형 지표(Ex. $\epsilon$ = 1: event of interest, $\epsilon$ = 2: competing risk )

-   결국 **위험 함수란 각 시점에서 event k 가 발생할 확률**을 뜻합니다.

## 누적발생률 함수(CIF)

$$
F_k(t) = \int_{0}^{t} \lambda_k(u) S(u) \, du
$$

 이벤트 k에 대한 **누적발생률 함수**란 결국 시점 마다 생존해 있을 확률 $S(t)$ 와 그 시점 에서 k가 발생할 위험 $\lambda_k(t)$를 곱하여 합산한 값으로, **시점 t에 이번트 k의 누적 발생률**을 뜻하게 됩니다. 여기서 생존 함수 S(t) 의 경우 직전 시점의 생존 확률인 S(t-1)과 시점 t에서 위험이 발생하지 않을 확률(1-$\lambda_1(t)$-$\lambda_2(t)$) 의 곱으로 계산됩니다.(만약 이벤트가 1,2인 경우)

## 왜 경쟁 위험 분석에서 CIF를 사용할까? 

경쟁 위험이 없는 생존 분석에서는 대게 Kaplan-Meier 추정치를 사용하지만, 이는 앞서 말했던 예시와 같이 이벤트 발생률을 과대 혹은 과소 평가할 위험이 있기 때문에 경쟁 위험이 있는 경우 적합하지 않은 경우가 많습니다. 암 재발과 사망의 예시를 다시 생각해보겠습니다. Kaplan-Meier 추정치의 경우 사망한 환자의 경우 censoring 된 것으로 처리가 되어 "이 환자의 경우 이후 정보는 알 수 없다"고 간주를 하고 계산하는 추정치입니다. 하지만, 현실에서는 사망한 환자의 경우 이후 암 재발이 일어날 가능성이 0이라는 것을 알 수 있습니다. 반면 CIF의 경우 수식에서도 볼 수 있듯이 사망이 발생해버린 사람은 이미 사건이 발생한 상태로 처리가 되며, 경쟁 이벤트가 발생했다는 $F_2(t)$라는 누적발생률 함수에 따로 기록되고 있는 것을 알 수 있습니다. 

# Competing Risk Analysis

그렇다면 경쟁 위험이 있는 경우 분석(예를 들어 group A와 group B에서 사망을 고려한 암 재발 발생률의 차이)를 어떻게 할 수 있는지 알아보겠습니다. 